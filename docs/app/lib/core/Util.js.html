<!DOCTYPE html><html><head><title>Util.js</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../../index.html" class="source"><span class="file_name">README</span></a><a href="../../../app/alloy.js.html" class="source "><span class="base_path">app / </span><span class="file_name">alloy.js</span></a><a href="../../../app/assets/specs/interpreterModule/interpreterModule.js.html" class="source "><span class="base_path">app / assets / specs / interpreterModule / </span><span class="file_name">interpreterModule.js</span></a><a href="../../../app/assets/specs/LocalDataHandler/localDataHandler.js.html" class="source "><span class="base_path">app / assets / specs / LocalDataHandler / </span><span class="file_name">localDataHandler.js</span></a><a href="../../../app/assets/specs/Parser/parserSpec.js.html" class="source "><span class="base_path">app / assets / specs / Parser / </span><span class="file_name">parserSpec.js</span></a><a href="../../../app/assets/specs/ResponseGenerator/responseGenerator.js.html" class="source "><span class="base_path">app / assets / specs / ResponseGenerator / </span><span class="file_name">responseGenerator.js</span></a><a href="../../../app/assets/specs/Soap/soapSpec.js.html" class="source "><span class="base_path">app / assets / specs / Soap / </span><span class="file_name">soapSpec.js</span></a><a href="../../../app/assets/specs/User/userSpec.js.html" class="source "><span class="base_path">app / assets / specs / User / </span><span class="file_name">userSpec.js</span></a><a href="../../../app/assets/specs/Validator/validatorSpec.js.html" class="source "><span class="base_path">app / assets / specs / Validator / </span><span class="file_name">validatorSpec.js</span></a><a href="../../../app/controllers/appHelp.js.html" class="source "><span class="base_path">app / controllers / </span><span class="file_name">appHelp.js</span></a><a href="../../../app/controllers/censusFooterView.js.html" class="source "><span class="base_path">app / controllers / </span><span class="file_name">censusFooterView.js</span></a><a href="../../../app/controllers/customRiskAssessmentRows/setEntireSectionTemplate.js.html" class="source "><span class="base_path">app / controllers / customRiskAssessmentRows / </span><span class="file_name">setEntireSectionTemplate.js</span></a><a href="../../../app/controllers/customRiskAssessmentRows/subsectionHeaderTemplate.js.html" class="source "><span class="base_path">app / controllers / customRiskAssessmentRows / </span><span class="file_name">subsectionHeaderTemplate.js</span></a><a href="../../../app/controllers/gotoQuestionSectionWindow/censusSelect/addCensusView.js.html" class="source "><span class="base_path">app / controllers / gotoQuestionSectionWindow / censusSelect / </span><span class="file_name">addCensusView.js</span></a><a href="../../../app/controllers/gotoQuestionSectionWindow/censusSelect/selectCensusView.js.html" class="source "><span class="base_path">app / controllers / gotoQuestionSectionWindow / censusSelect / </span><span class="file_name">selectCensusView.js</span></a><a href="../../../app/controllers/gotoQuestionSectionWindow/detailRowHeaderTemplate.js.html" class="source "><span class="base_path">app / controllers / gotoQuestionSectionWindow / </span><span class="file_name">detailRowHeaderTemplate.js</span></a><a href="../../../app/controllers/gotoQuestionSectionWindow/detailRowQuestionTemplate.js.html" class="source "><span class="base_path">app / controllers / gotoQuestionSectionWindow / </span><span class="file_name">detailRowQuestionTemplate.js</span></a><a href="../../../app/controllers/gotoQuestionSectionWindow/detailRowSection.js.html" class="source "><span class="base_path">app / controllers / gotoQuestionSectionWindow / </span><span class="file_name">detailRowSection.js</span></a><a href="../../../app/controllers/gotoQuestionSectionWindow/goToQuestionDetailView.js.html" class="source "><span class="base_path">app / controllers / gotoQuestionSectionWindow / </span><span class="file_name">goToQuestionDetailView.js</span></a><a href="../../../app/controllers/gotoQuestionSectionWindow/goToQuestionMasterView.js.html" class="source "><span class="base_path">app / controllers / gotoQuestionSectionWindow / </span><span class="file_name">goToQuestionMasterView.js</span></a><a href="../../../app/controllers/gotoQuestionSectionWindow/goToQuestionRow.js.html" class="source "><span class="base_path">app / controllers / gotoQuestionSectionWindow / </span><span class="file_name">goToQuestionRow.js</span></a><a href="../../../app/controllers/gotoQuestionSectionWindow/gotoQuestionSectionWindow.js.html" class="source "><span class="base_path">app / controllers / gotoQuestionSectionWindow / </span><span class="file_name">gotoQuestionSectionWindow.js</span></a><a href="../../../app/controllers/gotoQuestionSectionWindow/goToSectionHeader.js.html" class="source "><span class="base_path">app / controllers / gotoQuestionSectionWindow / </span><span class="file_name">goToSectionHeader.js</span></a><a href="../../../app/controllers/gotoQuestionSectionWindow/masterCensusDesktopCompleteTemplate.js.html" class="source "><span class="base_path">app / controllers / gotoQuestionSectionWindow / </span><span class="file_name">masterCensusDesktopCompleteTemplate.js</span></a><a href="../../../app/controllers/gotoQuestionSectionWindow/masterCensusRowTemplate.js.html" class="source "><span class="base_path">app / controllers / gotoQuestionSectionWindow / </span><span class="file_name">masterCensusRowTemplate.js</span></a><a href="../../../app/controllers/gotoQuestionSectionWindow/masterRowTemplate.js.html" class="source "><span class="base_path">app / controllers / gotoQuestionSectionWindow / </span><span class="file_name">masterRowTemplate.js</span></a><a href="../../../app/controllers/gotoQuestionSectionWindow/riskAssessmentPageRowTemplate.js.html" class="source "><span class="base_path">app / controllers / gotoQuestionSectionWindow / </span><span class="file_name">riskAssessmentPageRowTemplate.js</span></a><a href="../../../app/controllers/gotoQuestionSectionWindow/sectionRow.js.html" class="source "><span class="base_path">app / controllers / gotoQuestionSectionWindow / </span><span class="file_name">sectionRow.js</span></a><a href="../../../app/controllers/index.js.html" class="source "><span class="base_path">app / controllers / </span><span class="file_name">index.js</span></a><a href="../../../app/controllers/main.js.html" class="source "><span class="base_path">app / controllers / </span><span class="file_name">main.js</span></a><a href="../../../app/controllers/questionDialogs/minuteHourTimePicker.js.html" class="source "><span class="base_path">app / controllers / questionDialogs / </span><span class="file_name">minuteHourTimePicker.js</span></a><a href="../../../app/controllers/questionDialogs/modalDatePicker.js.html" class="source "><span class="base_path">app / controllers / questionDialogs / </span><span class="file_name">modalDatePicker.js</span></a><a href="../../../app/controllers/questionDialogs/modalMultiPicker.js.html" class="source "><span class="base_path">app / controllers / questionDialogs / </span><span class="file_name">modalMultiPicker.js</span></a><a href="../../../app/controllers/questionDialogs/modalPicker.js.html" class="source "><span class="base_path">app / controllers / questionDialogs / </span><span class="file_name">modalPicker.js</span></a><a href="../../../app/controllers/questionDialogs/userNotesDialog.js.html" class="source "><span class="base_path">app / controllers / questionDialogs / </span><span class="file_name">userNotesDialog.js</span></a><a href="../../../app/controllers/questionRenderer.js.html" class="source "><span class="base_path">app / controllers / </span><span class="file_name">questionRenderer.js</span></a><a href="../../../app/controllers/questionRendererTab.js.html" class="source "><span class="base_path">app / controllers / </span><span class="file_name">questionRendererTab.js</span></a><a href="../../../app/controllers/questionSectionHeader.js.html" class="source "><span class="base_path">app / controllers / </span><span class="file_name">questionSectionHeader.js</span></a><a href="../../../app/controllers/questionSectionNavigation.js.html" class="source "><span class="base_path">app / controllers / </span><span class="file_name">questionSectionNavigation.js</span></a><a href="../../../app/controllers/questionTemplates/censusCounterTemplate.js.html" class="source "><span class="base_path">app / controllers / questionTemplates / </span><span class="file_name">censusCounterTemplate.js</span></a><a href="../../../app/controllers/questionTemplates/censusStartTimerTemplate.js.html" class="source "><span class="base_path">app / controllers / questionTemplates / </span><span class="file_name">censusStartTimerTemplate.js</span></a><a href="../../../app/controllers/questionTemplates/dateRangeTemplate.js.html" class="source "><span class="base_path">app / controllers / questionTemplates / </span><span class="file_name">dateRangeTemplate.js</span></a><a href="../../../app/controllers/questionTemplates/dateSelectTemplate.js.html" class="source "><span class="base_path">app / controllers / questionTemplates / </span><span class="file_name">dateSelectTemplate.js</span></a><a href="../../../app/controllers/questionTemplates/minuteHourTimeTemplate.js.html" class="source "><span class="base_path">app / controllers / questionTemplates / </span><span class="file_name">minuteHourTimeTemplate.js</span></a><a href="../../../app/controllers/questionTemplates/multiSelectTemplate.js.html" class="source "><span class="base_path">app / controllers / questionTemplates / </span><span class="file_name">multiSelectTemplate.js</span></a><a href="../../../app/controllers/questionTemplates/rangeFieldTemplate.js.html" class="source "><span class="base_path">app / controllers / questionTemplates / </span><span class="file_name">rangeFieldTemplate.js</span></a><a href="../../../app/controllers/questionTemplates/singleSelectTemplate.js.html" class="source "><span class="base_path">app / controllers / questionTemplates / </span><span class="file_name">singleSelectTemplate.js</span></a><a href="../../../app/controllers/questionTemplates/textFieldTemplate.js.html" class="source "><span class="base_path">app / controllers / questionTemplates / </span><span class="file_name">textFieldTemplate.js</span></a><a href="../../../app/controllers/riskAssessments/commitMessageView.js.html" class="source "><span class="base_path">app / controllers / riskAssessments / </span><span class="file_name">commitMessageView.js</span></a><a href="../../../app/controllers/riskAssessments/riskAssessmentsWindow.js.html" class="source "><span class="base_path">app / controllers / riskAssessments / </span><span class="file_name">riskAssessmentsWindow.js</span></a><a href="../../../app/controllers/riskAssessments/riskAssessmentTableRow.js.html" class="source "><span class="base_path">app / controllers / riskAssessments / </span><span class="file_name">riskAssessmentTableRow.js</span></a><a href="../../../app/controllers/searchWindow/masterSearchTab.js.html" class="source "><span class="base_path">app / controllers / searchWindow / </span><span class="file_name">masterSearchTab.js</span></a><a href="../../../app/controllers/searchWindow/masterSearchTableRow.js.html" class="source "><span class="base_path">app / controllers / searchWindow / </span><span class="file_name">masterSearchTableRow.js</span></a><a href="../../../app/controllers/selectRouteWindow.js.html" class="source "><span class="base_path">app / controllers / </span><span class="file_name">selectRouteWindow.js</span></a><a href="../../../app/controllers/startup.js.html" class="source "><span class="base_path">app / controllers / </span><span class="file_name">startup.js</span></a><a href="../../../app/controllers/userNotificationWindows/activityIndicatorDialog.js.html" class="source "><span class="base_path">app / controllers / userNotificationWindows / </span><span class="file_name">activityIndicatorDialog.js</span></a><a href="../../../app/controllers/userSettings.js.html" class="source "><span class="base_path">app / controllers / </span><span class="file_name">userSettings.js</span></a><a href="../../../app/lib/core/Analytics.js.html" class="source "><span class="base_path">app / lib / core / </span><span class="file_name">Analytics.js</span></a><a href="../../../app/lib/core/Logger.js.html" class="source "><span class="base_path">app / lib / core / </span><span class="file_name">Logger.js</span></a><a href="../../../app/lib/core/Soap.js.html" class="source "><span class="base_path">app / lib / core / </span><span class="file_name">Soap.js</span></a><a href="../../../app/lib/core/Soap_FAT.js.html" class="source "><span class="base_path">app / lib / core / </span><span class="file_name">Soap_FAT.js</span></a><a href="../../../app/lib/core/Ui.js.html" class="source "><span class="base_path">app / lib / core / </span><span class="file_name">Ui.js</span></a><a href="../../../app/lib/core/User.js.html" class="source "><span class="base_path">app / lib / core / </span><span class="file_name">User.js</span></a><a href="../../../app/lib/core/Util.js.html" class="source selected"><span class="base_path">app / lib / core / </span><span class="file_name">Util.js</span></a><a href="../../../app/lib/interpreter/interpreterModule2.js.html" class="source "><span class="base_path">app / lib / interpreter / </span><span class="file_name">interpreterModule2.js</span></a><a href="../../../app/lib/localDataHandler/localDataHandler.js.html" class="source "><span class="base_path">app / lib / localDataHandler / </span><span class="file_name">localDataHandler.js</span></a><a href="../../../app/lib/parser/localParser.js.html" class="source "><span class="base_path">app / lib / parser / </span><span class="file_name">localParser.js</span></a><a href="../../../app/lib/responseGenerator/responseGenerator.js.html" class="source "><span class="base_path">app / lib / responseGenerator / </span><span class="file_name">responseGenerator.js</span></a><a href="../../../app/lib/styles/styles.js.html" class="source "><span class="base_path">app / lib / styles / </span><span class="file_name">styles.js</span></a><a href="../../../app/lib/test-framework/jasmine.js.html" class="source "><span class="base_path">app / lib / test-framework / </span><span class="file_name">jasmine.js</span></a><a href="../../../app/lib/test-framework/tijasmine-console.js.html" class="source "><span class="base_path">app / lib / test-framework / </span><span class="file_name">tijasmine-console.js</span></a><a href="../../../app/lib/test-framework/tijasmine.js.html" class="source "><span class="base_path">app / lib / test-framework / </span><span class="file_name">tijasmine.js</span></a><a href="../../../app/lib/tests_runner.js.html" class="source "><span class="base_path">app / lib / </span><span class="file_name">tests_runner.js</span></a><a href="../../../app/lib/tools/fonts/FontAwesome.js.html" class="source "><span class="base_path">app / lib / tools / fonts / </span><span class="file_name">FontAwesome.js</span></a><a href="../../../app/lib/tools/fonts/IconicFont.js.html" class="source "><span class="base_path">app / lib / tools / fonts / </span><span class="file_name">IconicFont.js</span></a><a href="../../../app/lib/tools/randexp.js.html" class="source "><span class="base_path">app / lib / tools / </span><span class="file_name">randexp.js</span></a><a href="../../../app/lib/tools/ret/index.js.html" class="source "><span class="base_path">app / lib / tools / ret / </span><span class="file_name">index.js</span></a><a href="../../../app/lib/tools/ret/positions.js.html" class="source "><span class="base_path">app / lib / tools / ret / </span><span class="file_name">positions.js</span></a><a href="../../../app/lib/tools/ret/sets.js.html" class="source "><span class="base_path">app / lib / tools / ret / </span><span class="file_name">sets.js</span></a><a href="../../../app/lib/tools/ret/types.js.html" class="source "><span class="base_path">app / lib / tools / ret / </span><span class="file_name">types.js</span></a><a href="../../../app/lib/tools/ret/util.js.html" class="source "><span class="base_path">app / lib / tools / ret / </span><span class="file_name">util.js</span></a><a href="../../../app/lib/tools/Suds2_fat.js.html" class="source "><span class="base_path">app / lib / tools / </span><span class="file_name">Suds2_fat.js</span></a><a href="../../../app/lib/validator/Validator.js.html" class="source "><span class="base_path">app / lib / validator / </span><span class="file_name">Validator.js</span></a><a href="../../../app/widgets/sh.dogfi.login/controllers/widget.js.html" class="source "><span class="base_path">app / widgets / sh.dogfi.login / controllers / </span><span class="file_name">widget.js</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>Util.js</h1><div class="filepath">app/lib/core/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">_Util</span><span class="p">()</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
    <span class="nx">docsFolder</span><span class="p">,</span> <span class="nx">templatesFolder</span><span class="p">,</span> <span class="nx">cmsUrl</span><span class="p">,</span> <span class="nx">templateFiles</span><span class="p">,</span> <span class="nx">crossingTypes</span><span class="p">,</span> <span class="nx">routeFiles</span><span class="p">,</span> <span class="nx">Alloy</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;alloy&quot;</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">connectivtiy_alert_shown</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">self</span><span class="p">.</span><span class="nx">connectivityChecker</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>listen for any network changes</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">Titanium</span><span class="p">.</span><span class="nx">Network</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">online</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>do nothing   </p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">connectivtiy_alert_shown</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">connectivtiy_alert_shown</span> <span class="o">==</span> <span class="kc">false</span><span class="p">){</span>
          <span class="nx">Alloy</span><span class="p">.</span><span class="nx">Globals</span><span class="p">.</span><span class="nx">aIndicator</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">showAlert</span><span class="p">(</span><span class="s1">&#39;Please make sure that you are connected to the Internet&#39;</span><span class="p">);</span>
          <span class="nx">connectivtiy_alert_shown</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">};</span>

  <span class="nx">self</span><span class="p">.</span><span class="nx">isIOS7Plus</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>iOS-specific test</p>
</td><td class="code"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">Titanium</span><span class="p">.</span><span class="nx">Platform</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;iPhone OS&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">version</span> <span class="o">=</span> <span class="nx">Titanium</span><span class="p">.</span><span class="nx">Platform</span><span class="p">.</span><span class="nx">version</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">major</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">version</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">10</span><span class="p">);</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>Can only test this support on a 3.2+ device</p>
</td><td class="code"><div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">major</span> <span class="o">&gt;=</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="nx">self</span><span class="p">.</span><span class="nx">getCmsUrl</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">cmsUrl</span><span class="p">;</span>
  <span class="p">};</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>Checks for an override file being left in by Iain</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">self</span><span class="p">.</span><span class="nx">getOverrideFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">overRideFile</span> <span class="o">=</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">Filesystem</span><span class="p">.</span><span class="nx">getFile</span><span class="p">(</span><span class="nx">docsFolder</span><span class="p">,</span> <span class="s1">&#39;endpoint_override.json&#39;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">overRideFile</span><span class="p">.</span><span class="nx">exists</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">overRideFile</span><span class="p">.</span><span class="nx">size</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">overRide</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">overRideFile</span><span class="p">.</span><span class="nx">read</span><span class="p">()),</span>
                <span class="nx">toReturn</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">overRide</span><span class="p">[</span><span class="s1">&#39;uri&#39;</span><span class="p">])</span> <span class="p">{</span>
                <span class="nx">toReturn</span><span class="p">[</span><span class="s1">&#39;uri&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">overRide</span><span class="p">[</span><span class="s1">&#39;uri&#39;</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">overRide</span><span class="p">[</span><span class="s1">&#39;ws_security&#39;</span><span class="p">])</span> <span class="p">{</span>
                <span class="nx">toReturn</span><span class="p">[</span><span class="s1">&#39;ws_security&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">overRide</span><span class="p">[</span><span class="s1">&#39;ws_security&#39;</span><span class="p">];</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nx">toReturn</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>|---------------------------------------------------------------------------------<br />     | Downloads a file -> if localFile is present, data is saved in this file<br />     | callback -> will be fired when download is complete and data is passed to callback<br />     |---------------------------------------------------------------------------------</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">self</span><span class="p">.</span><span class="nx">downloadFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">localFile</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">Ti</span><span class="p">.</span><span class="nx">API</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;Downloading file at &#39;</span> <span class="o">+</span> <span class="nx">url</span> <span class="o">+</span> <span class="s1">&#39; to &#39;</span> <span class="o">+</span> <span class="nx">localFile</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">Network</span><span class="p">.</span><span class="nx">createHTTPClient</span><span class="p">({</span>
      <span class="nx">onload</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">localFile</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">Filesystem</span><span class="p">.</span><span class="nx">getFile</span><span class="p">(</span><span class="nx">localFile</span><span class="p">);</span>
          <span class="nx">f</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">responseData</span><span class="p">);</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>self.log('Writing ' + this.responseData + ' to file ' + localFile);</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">f</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>Passing data back to callback</p>
</td><td class="code"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span> <span class="o">&amp;&amp;</span> <span class="nx">url</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="s2">&quot;.pdf&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">responseData</span><span class="p">));</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">onerror</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Alloy</span><span class="p">.</span><span class="nx">Globals</span><span class="p">.</span><span class="nx">Logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;There has been an error downloading file &#39;</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">error</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">timeout</span><span class="o">:</span> <span class="mi">40000</span>
    <span class="p">});</span>

    <span class="nx">c</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

  <span class="p">};</span>

  <span class="nx">self</span><span class="p">.</span><span class="nx">downloadFileConditionally</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">localFile</span><span class="p">,</span> <span class="nx">condition</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">Ti</span><span class="p">.</span><span class="nx">API</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;Downloading file at &#39;</span> <span class="o">+</span> <span class="nx">url</span> <span class="o">+</span> <span class="s1">&#39; to &#39;</span> <span class="o">+</span> <span class="nx">localFile</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">Network</span><span class="p">.</span><span class="nx">createHTTPClient</span><span class="p">({</span>
      <span class="nx">onload</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">condition</span><span class="p">(</span><span class="nx">c</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">localFile</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">Filesystem</span><span class="p">.</span><span class="nx">getFile</span><span class="p">(</span><span class="nx">localFile</span><span class="p">);</span>
            <span class="nx">f</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">responseData</span><span class="p">);</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>self.log('Writing ' + this.responseData + ' to file ' + localFile);</p>
</td><td class="code"><div class="highlight"><pre>            <span class="nx">f</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
          <span class="p">}</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>Passing data back to callback</p>
</td><td class="code"><div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span> <span class="o">&amp;&amp;</span> <span class="nx">url</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="s2">&quot;.pdf&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">callback</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">responseData</span><span class="p">),</span> <span class="nx">c</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">onerror</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>self.log('There has been an error downloading file ' + e.error);</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">Alloy</span><span class="p">.</span><span class="nx">Globals</span><span class="p">.</span><span class="nx">Logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;There has been an error downloading file &#39;</span><span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">error</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">timeout</span><span class="o">:</span> <span class="mi">40000</span>
    <span class="p">});</span>

    <span class="nx">c</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>

  <span class="p">};</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>|---------------------------------------------------------------------------------<br />     | Downloads app level help for the app<br />     |---------------------------------------------------------------------------------</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">self</span><span class="p">.</span><span class="nx">downloadConfig</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    

    
    <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">phoneConnected</span><span class="p">())</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">fileName</span> <span class="o">=</span> <span class="s1">&#39;appconfig.json&#39;</span><span class="p">;</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">downloadFileConditionally</span><span class="p">(</span><span class="nx">cmsUrl</span> <span class="o">+</span> <span class="s1">&#39;/data/appconfig.json&#39;</span><span class="p">,</span> <span class="nx">docsFolder</span> <span class="o">+</span> <span class="nx">fileName</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>returning true as last modified date isn't consistent</p>
</td><td class="code"><div class="highlight"><pre>        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>

      <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">client</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Ti</span><span class="p">.</span><span class="nx">App</span><span class="p">.</span><span class="nx">Properties</span><span class="p">.</span><span class="nx">setString</span><span class="p">(</span><span class="s1">&#39;helpContent&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">help</span><span class="p">);</span>
        <span class="nx">Ti</span><span class="p">.</span><span class="nx">App</span><span class="p">.</span><span class="nx">Properties</span><span class="p">.</span><span class="nx">setString</span><span class="p">(</span><span class="s1">&#39;stagedRollOutRoutes&#39;</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">routes</span><span class="p">));</span>
        <span class="nx">Ti</span><span class="p">.</span><span class="nx">App</span><span class="p">.</span><span class="nx">Properties</span><span class="p">.</span><span class="nx">setList</span><span class="p">(</span><span class="s1">&#39;censusCounterQuestions&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">censusCounterQuestions</span><span class="p">);</span>
        <span class="nx">Ti</span><span class="p">.</span><span class="nx">App</span><span class="p">.</span><span class="nx">Properties</span><span class="p">.</span><span class="nx">setList</span><span class="p">(</span><span class="s1">&#39;removedSections&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">removedSections</span><span class="p">);</span>
        <span class="nx">Ti</span><span class="p">.</span><span class="nx">App</span><span class="p">.</span><span class="nx">Properties</span><span class="p">.</span><span class="nx">setList</span><span class="p">(</span><span class="s1">&#39;removedQuestions&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">removedQuestions</span><span class="p">);</span>
        <span class="nx">Ti</span><span class="p">.</span><span class="nx">App</span><span class="p">.</span><span class="nx">Properties</span><span class="p">.</span><span class="nx">setList</span><span class="p">(</span><span class="s1">&#39;hiddenQuestions&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">hiddenQuestions</span><span class="p">);</span>
        <span class="nx">Ti</span><span class="p">.</span><span class="nx">App</span><span class="p">.</span><span class="nx">Properties</span><span class="p">.</span><span class="nx">setList</span><span class="p">(</span><span class="s1">&#39;timerPickerQuestions&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">timerPickerQuestions</span><span class="p">);</span>
        
        <span class="nx">Ti</span><span class="p">.</span><span class="nx">App</span><span class="p">.</span><span class="nx">Properties</span><span class="p">.</span><span class="nx">setString</span><span class="p">(</span><span class="s1">&#39;wsTimeout&#39;</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">wsTimeout</span><span class="p">));</span>
        <span class="nx">Ti</span><span class="p">.</span><span class="nx">App</span><span class="p">.</span><span class="nx">Properties</span><span class="p">.</span><span class="nx">setString</span><span class="p">(</span><span class="s1">&#39;maxCrossings&#39;</span><span class="p">,</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">maxCrossings</span><span class="p">));</span>
        <span class="nx">Ti</span><span class="p">.</span><span class="nx">App</span><span class="p">.</span><span class="nx">Properties</span><span class="p">.</span><span class="nx">setString</span><span class="p">(</span><span class="s1">&#39;helpLastModified&#39;</span><span class="p">,</span> <span class="nx">client</span><span class="p">.</span><span class="nx">getResponseHeader</span><span class="p">(</span><span class="s1">&#39;Last-Modified&#39;</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">callback</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">Filesystem</span><span class="p">.</span><span class="nx">getFile</span><span class="p">(</span><span class="s2">&quot;appconfig.json&quot;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">read</span><span class="p">().</span><span class="nx">text</span><span class="p">);</span>
      <span class="nx">Ti</span><span class="p">.</span><span class="nx">App</span><span class="p">.</span><span class="nx">Properties</span><span class="p">.</span><span class="nx">setString</span><span class="p">(</span><span class="s1">&#39;helpContent&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">help</span><span class="p">);</span>
      <span class="nx">Ti</span><span class="p">.</span><span class="nx">App</span><span class="p">.</span><span class="nx">Properties</span><span class="p">.</span><span class="nx">setString</span><span class="p">(</span><span class="s1">&#39;stagedRollOutRoutes&#39;</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">routes</span><span class="p">));</span>
      <span class="nx">Ti</span><span class="p">.</span><span class="nx">App</span><span class="p">.</span><span class="nx">Properties</span><span class="p">.</span><span class="nx">setList</span><span class="p">(</span><span class="s1">&#39;censusCounterQuestions&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">censusCounterQuestions</span><span class="p">);</span>
      <span class="nx">Ti</span><span class="p">.</span><span class="nx">App</span><span class="p">.</span><span class="nx">Properties</span><span class="p">.</span><span class="nx">setList</span><span class="p">(</span><span class="s1">&#39;removedSections&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">removedSections</span><span class="p">);</span>
      <span class="nx">Ti</span><span class="p">.</span><span class="nx">App</span><span class="p">.</span><span class="nx">Properties</span><span class="p">.</span><span class="nx">setList</span><span class="p">(</span><span class="s1">&#39;removedQuestions&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">removedQuestions</span><span class="p">);</span>
      <span class="nx">Ti</span><span class="p">.</span><span class="nx">App</span><span class="p">.</span><span class="nx">Properties</span><span class="p">.</span><span class="nx">setList</span><span class="p">(</span><span class="s1">&#39;hiddenQuestions&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">hiddenQuestions</span><span class="p">);</span>
      <span class="nx">Ti</span><span class="p">.</span><span class="nx">App</span><span class="p">.</span><span class="nx">Properties</span><span class="p">.</span><span class="nx">setList</span><span class="p">(</span><span class="s1">&#39;timerPickerQuestions&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">timerPickerQuestions</span><span class="p">);</span>
      <span class="nx">Ti</span><span class="p">.</span><span class="nx">App</span><span class="p">.</span><span class="nx">Properties</span><span class="p">.</span><span class="nx">setString</span><span class="p">(</span><span class="s1">&#39;wsTimeout&#39;</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">wsTimeout</span><span class="p">));</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>Ti.App.Properties.setString('helpLastModified', client.getResponseHeader('Last-Modified'));</p>
</td><td class="code"><div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callback</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
  <span class="p">};</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>cmsUrl = 'http://dogfishdata.com/alcrm_cms';</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">cmsUrl</span> <span class="o">=</span> <span class="s1">&#39;http://phase2.nwrcrossings.co.uk&#39;</span><span class="p">;</span>
  <span class="nx">docsFolder</span> <span class="o">=</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">Filesystem</span><span class="p">.</span><span class="nx">getApplicationDataDirectory</span><span class="p">();</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>Function to bring the route picker up</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">self</span><span class="p">.</span><span class="nx">showRoutePicker</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">routes</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
    <span class="nx">Alloy</span><span class="p">.</span><span class="nx">createController</span><span class="p">(</span><span class="s1">&#39;selectRouteWindow&#39;</span><span class="p">).</span><span class="nx">getView</span><span class="p">().</span><span class="nx">open</span><span class="p">();</span>
  <span class="p">};</span>

  <span class="nx">self</span><span class="p">.</span><span class="nx">convertDate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">date</span> <span class="o">=</span> <span class="nx">date</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})/</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">date</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">dateObj</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">dateFormat1</span><span class="o">:</span> <span class="nx">date</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">date</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">date</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="nx">dateFormat2</span><span class="o">:</span> <span class="nx">date</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">date</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">date</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="nx">dateFormat3</span><span class="o">:</span> <span class="nx">date</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">date</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">date</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="nx">dateFormat4</span><span class="o">:</span> <span class="nx">date</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">date</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nx">date</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="nx">time</span><span class="o">:</span> <span class="nx">date</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nx">date</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nx">date</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="nx">dateObj</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>|---------------------------------------------------------------------------------<br />     | Get all active assessments<br />     |---------------------------------------------------------------------------------</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">self</span><span class="p">.</span><span class="nx">getActiveAssessments</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">assessmentsFolder</span> <span class="o">=</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">Filesystem</span><span class="p">.</span><span class="nx">getFile</span><span class="p">(</span><span class="nx">docsFolder</span><span class="p">,</span> <span class="s1">&#39;assessments&#39;</span><span class="p">),</span>
      <span class="nx">dirFiles</span> <span class="o">=</span> <span class="nx">assessmentsFolder</span><span class="p">.</span><span class="nx">getDirectoryListing</span><span class="p">(),</span>
      <span class="nx">outputObj</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">dirFiles</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">dirFiles</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>Get all the json files</p>
</td><td class="code"><div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">dirFiles</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">Filesystem</span><span class="p">.</span><span class="nx">getFile</span><span class="p">(</span><span class="nx">docsFolder</span> <span class="o">+</span> <span class="s1">&#39;/assessments/&#39;</span> <span class="o">+</span> <span class="nx">dirFiles</span><span class="p">[</span><span class="nx">i</span><span class="p">]),</span>
          <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">read</span><span class="p">());</span>
        <span class="nx">timestamp</span> <span class="o">=</span> <span class="nx">file</span><span class="p">.</span><span class="nx">modificationTimestamp</span><span class="p">();</span>

        <span class="nx">outputObj</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
          <span class="nx">data</span><span class="o">:</span> <span class="nx">data</span><span class="p">,</span>
          <span class="nx">timeStamp</span><span class="o">:</span> <span class="nx">timestamp</span>
        <span class="p">});</span>

        <span class="nx">file</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>Now sort based on timeStamp</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">outputObj</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">timeStamp</span> <span class="o">-</span> <span class="nx">a</span><span class="p">.</span><span class="nx">timeStamp</span><span class="p">);</span>
    <span class="p">});</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>Now extract to another array</p>
</td><td class="code"><div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">outputArray</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">outputObj</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">outputArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">outputObj</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">assessmentsFolder</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="nx">dirFiles</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">outputArray</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="nx">self</span><span class="p">.</span><span class="nx">escapeXML</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>From https://gist.github.com/panzi/1857360</p>
</td><td class="code"><div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">XML_CHAR_MAP</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;&lt;&#39;</span><span class="o">:</span> <span class="s1">&#39;&amp;lt;&#39;</span><span class="p">,</span>
      <span class="s1">&#39;&gt;&#39;</span><span class="o">:</span> <span class="s1">&#39;&amp;gt;&#39;</span><span class="p">,</span>
      <span class="s1">&#39;&amp;&#39;</span><span class="o">:</span> <span class="s1">&#39;&amp;amp;&#39;</span><span class="p">,</span>
      <span class="s1">&#39;&quot;&#39;</span><span class="o">:</span> <span class="s1">&#39;&amp;quot;&#39;</span><span class="p">,</span>
      <span class="s2">&quot;&#39;&quot;</span><span class="o">:</span> <span class="s1">&#39;&amp;apos;&#39;</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[&lt;&gt;&amp;&quot;&#39;]/g</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ch</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">XML_CHAR_MAP</span><span class="p">[</span><span class="nx">ch</span><span class="p">];</span>
    <span class="p">});</span>
  <span class="p">};</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>|---------------------------------------------------------------------------------<br />     | Emails assessment and question notes to the user<br />     |---------------------------------------------------------------------------------</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">self</span><span class="p">.</span><span class="nx">emailNotes</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p>var Alloy.Globals.User = require('core/Alloy.Globals.User');</p>
</td><td class="code"><div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">userEmail</span> <span class="o">=</span> <span class="nx">Alloy</span><span class="p">.</span><span class="nx">Globals</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">getEmail</span><span class="p">();</span>
    <span class="nx">Ti</span><span class="p">.</span><span class="nx">API</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s2">&quot;userEmail = &quot;</span> <span class="o">+</span> <span class="nx">userEmail</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">userEmail</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">email</span><span class="o">:</span> <span class="nx">userEmail</span><span class="p">,</span></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>message: message,</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">archived</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span>
    <span class="p">};</span>
    <span class="nx">Ti</span><span class="p">.</span><span class="nx">API</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">archived</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">Network</span><span class="p">.</span><span class="nx">createHTTPClient</span><span class="p">({</span>
      <span class="nx">onload</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div></td></tr><tr id="section-26"><td class="docs"><div class="pilwrap"><a href="#section-26" class="pilcrow">&#182;</a></div><p>self.log('Assessment and Question Notes emailed successfully');</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">Alloy</span><span class="p">.</span><span class="nx">Globals</span><span class="p">.</span><span class="nx">Logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Assessment and Question Notes emailed successfully&#39;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">onerror</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-27"><td class="docs"><div class="pilwrap"><a href="#section-27" class="pilcrow">&#182;</a></div><p>self.log('Error emailing Assessment and Question Notes');</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">Alloy</span><span class="p">.</span><span class="nx">Globals</span><span class="p">.</span><span class="nx">Logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Error emailing Assessment and Question Notes&#39;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">timeout</span><span class="o">:</span> <span class="mi">40000</span>
    <span class="p">});</span>

    <span class="nx">c</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="nx">cmsUrl</span> <span class="o">+</span> <span class="s1">&#39;/api/email.php&#39;</span><span class="p">);</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
  <span class="p">};</span></pre></div></td></tr><tr id="section-28"><td class="docs"><div class="pilwrap"><a href="#section-28" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>|---------------------------------------------------------------------------------<br />     | Emails a bug report by using the cms api<br />     |---------------------------------------------------------------------------------</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">self</span><span class="p">.</span><span class="nx">sendBugReport</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">success</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">emailDialog</span> <span class="o">=</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">UI</span><span class="p">.</span><span class="nx">createEmailDialog</span><span class="p">();</span>
    <span class="nx">emailDialog</span><span class="p">.</span><span class="nx">subject</span> <span class="o">=</span> <span class="s1">&#39;RA App bug report from &#39;</span> <span class="o">+</span> <span class="nx">args</span><span class="p">.</span><span class="nx">userName</span><span class="p">;</span>

    <span class="nx">emailDialog</span><span class="p">.</span><span class="nx">messageBody</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">emailBody</span><span class="p">;</span>
    <span class="nx">emailDialog</span><span class="p">.</span><span class="nx">toRecipients</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;paul.haggett@networkrail.co.uk&#39;</span><span class="p">];</span>

    <span class="nx">emailDialog</span><span class="p">.</span><span class="nx">addAttachment</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">docsZip</span><span class="p">);</span>
    <span class="nx">emailDialog</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;complete&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="nx">args</span><span class="p">.</span><span class="nx">docsZip</span><span class="p">.</span><span class="nx">deleteFile</span><span class="p">();</span>
      <span class="nx">args</span><span class="p">.</span><span class="nx">docsZip</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">emailDialog</span><span class="p">.</span><span class="nx">isSupported</span><span class="p">())</span> <span class="p">{</span>
      <span class="nx">emailDialog</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">showAlert</span><span class="p">(</span><span class="nx">L</span><span class="p">(</span><span class="s1">&#39;no_email_client&#39;</span><span class="p">));</span>
    <span class="p">}</span>

  <span class="p">};</span>

  <span class="nx">self</span><span class="p">.</span><span class="nx">zipUpDocumentsFolder</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div></td></tr><tr id="section-29"><td class="docs"><div class="pilwrap"><a href="#section-29" class="pilcrow">&#182;</a></div><p>Will return all the files of a folder in an array</p>
</td><td class="code"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">returnFilesFromDir</span><span class="p">(</span><span class="nx">folder</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">outputArray</span> <span class="o">=</span> <span class="p">[];</span>

      <span class="k">try</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">dir</span> <span class="o">=</span> <span class="nx">Titanium</span><span class="p">.</span><span class="nx">Filesystem</span><span class="p">.</span><span class="nx">getFile</span><span class="p">(</span><span class="nx">folder</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">dir_files</span> <span class="o">=</span> <span class="nx">dir</span><span class="p">.</span><span class="nx">getDirectoryListing</span><span class="p">();</span>

        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">dir_files</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">dir_files</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">toString</span><span class="p">()</span> <span class="o">!==</span> <span class="s1">&#39;bugReport.zip&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-30"><td class="docs"><div class="pilwrap"><a href="#section-30" class="pilcrow">&#182;</a></div><p>get the file now</p>
</td><td class="code"><div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">Titanium</span><span class="p">.</span><span class="nx">Filesystem</span><span class="p">.</span><span class="nx">getFile</span><span class="p">(</span><span class="nx">dir_files</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span></pre></div></td></tr><tr id="section-31"><td class="docs"><div class="pilwrap"><a href="#section-31" class="pilcrow">&#182;</a></div><p>We only need the files inside the folder </p>
</td><td class="code"><div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">dir_files</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">toString</span><span class="p">().</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">outputArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">dir_files</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">toString</span><span class="p">());</span></pre></div></td></tr><tr id="section-32"><td class="docs"><div class="pilwrap"><a href="#section-32" class="pilcrow">&#182;</a></div><p>outputArray.push(folder + '/' + dir_files[i].toString());</p>
</td><td class="code"><div class="highlight"><pre>            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">Alloy</span><span class="p">.</span><span class="nx">Globals</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">getLogin</span><span class="p">().</span><span class="nx">username</span> <span class="o">===</span> <span class="nx">dir_files</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">toString</span><span class="p">()){</span></pre></div></td></tr><tr id="section-33"><td class="docs"><div class="pilwrap"><a href="#section-33" class="pilcrow">&#182;</a></div><p>maybe a directory 
we only need the logged in directory of the user</p>
</td><td class="code"><div class="highlight"><pre>              <span class="nx">outputArray</span> <span class="o">=</span> <span class="nx">outputArray</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">returnFilesFromDir</span><span class="p">(</span><span class="nx">folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">dir_files</span><span class="p">[</span><span class="nx">i</span><span class="p">]));</span>
            <span class="p">}</span>
            <span class="nx">file</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>

      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">outputArray</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="kd">var</span> <span class="nx">docsFolder</span> <span class="o">=</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">Filesystem</span><span class="p">.</span><span class="nx">applicationDataDirectory</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">outPutFile</span> <span class="o">=</span> <span class="nx">docsFolder</span> <span class="o">+</span> <span class="s1">&#39;/bugReport.zip&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">Compression</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;ti.compression&#39;</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">filesToZip</span> <span class="o">=</span> <span class="p">[];</span>
    
    <span class="nx">filesToZip</span> <span class="o">=</span> <span class="nx">returnFilesFromDir</span><span class="p">(</span><span class="nx">docsFolder</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">filesToZip</span><span class="p">.</span><span class="nx">length</span><span class="o">!==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">Compression</span><span class="p">.</span><span class="nx">zip</span><span class="p">(</span><span class="nx">outPutFile</span><span class="p">,</span> <span class="nx">filesToZip</span><span class="p">);</span></pre></div></td></tr><tr id="section-34"><td class="docs"><div class="pilwrap"><a href="#section-34" class="pilcrow">&#182;</a></div><p>Now read the zip file</p>
</td><td class="code"><div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">zipFile</span> <span class="o">=</span> <span class="nx">Titanium</span><span class="p">.</span><span class="nx">Filesystem</span><span class="p">.</span><span class="nx">getFile</span><span class="p">(</span><span class="nx">outPutFile</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">zipFile</span><span class="p">.</span><span class="nx">exists</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">zipFile</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div></td></tr><tr id="section-35"><td class="docs"><div class="pilwrap"><a href="#section-35" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>|---------------------------------------------------------------------------------<br />     | Function to check whether we a nested json structure exists<br />     |---------------------------------------------------------------------------------</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">self</span><span class="p">.</span><span class="nx">checkNested</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span> <span class="cm">/*, level1, level2, ... levelN*/</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">),</span>
      <span class="nx">obj</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">obj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">obj</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">]];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="nx">self</span><span class="p">.</span><span class="nx">retryJson</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">payload</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">alertYesNo</span> <span class="o">=</span> <span class="nx">Titanium</span><span class="p">.</span><span class="nx">UI</span><span class="p">.</span><span class="nx">createAlertDialog</span><span class="p">({</span>
      <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;An error occured, would you like to retry?&#39;</span><span class="p">,</span>
      <span class="nx">buttonNames</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;Yes&#39;</span><span class="p">,</span> <span class="s1">&#39;No&#39;</span><span class="p">]</span>
    <span class="p">});</span>

    <span class="nx">alertYesNo</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-36"><td class="docs"><div class="pilwrap"><a href="#section-36" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><ul>
<li>YES was clicked.</li>
</ul></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">Alloy</span><span class="p">.</span><span class="nx">Globals</span><span class="p">.</span><span class="nx">aIndicator</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="s2">&quot;Loading...&quot;</span><span class="p">);</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">convertJson</span><span class="p">(</span><span class="nx">payload</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-37"><td class="docs"><div class="pilwrap"><a href="#section-37" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><ul>
<li>Put the row back since it will be removed from the view even if NO is clicked.</li>
</ul></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">Alloy</span><span class="p">.</span><span class="nx">Globals</span><span class="p">.</span><span class="nx">aIndicator</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">alertYesNo</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
  <span class="p">};</span></pre></div></td></tr><tr id="section-38"><td class="docs"><div class="pilwrap"><a href="#section-38" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>|---------------------------------------------------------------------------------<br />     | Convert xml to json by executing a web request<br />     |---------------------------------------------------------------------------------</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">self</span><span class="p">.</span><span class="nx">convertJson</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">payload</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">xmlContent</span><span class="o">:</span> <span class="nx">payload</span>
    <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">Network</span><span class="p">.</span><span class="nx">createHTTPClient</span><span class="p">({</span>
      <span class="nx">onload</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">response</span> <span class="o">===</span> <span class="s1">&#39;error&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-39"><td class="docs"><div class="pilwrap"><a href="#section-39" class="pilcrow">&#182;</a></div><p>alert('Error converting xml');</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nx">self</span><span class="p">.</span><span class="nx">retryJson</span><span class="p">(</span><span class="nx">payload</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">callback</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">onerror</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-40"><td class="docs"><div class="pilwrap"><a href="#section-40" class="pilcrow">&#182;</a></div><p>alert('Error converting xml');</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nx">self</span><span class="p">.</span><span class="nx">retryJson</span><span class="p">(</span><span class="nx">payload</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">timeout</span><span class="o">:</span> <span class="mi">60000</span>
    <span class="p">});</span>

    <span class="nx">c</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="nx">cmsUrl</span> <span class="o">+</span> <span class="s1">&#39;/api/xmlConvertor.php&#39;</span><span class="p">);</span>
    <span class="nx">c</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="nx">self</span><span class="p">.</span><span class="nx">getRandomThreeDigit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2000</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="nx">self</span><span class="p">.</span><span class="nx">getRandom</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">From</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-41"><td class="docs"><div class="pilwrap"><a href="#section-41" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><ul>
<li>Returns a random number from param limit</li>
</ul></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">From</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="nx">self</span><span class="p">.</span><span class="nx">phoneConnected</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">Titanium</span><span class="p">.</span><span class="nx">Network</span><span class="p">.</span><span class="nx">networkType</span> <span class="o">===</span> <span class="nx">Titanium</span><span class="p">.</span><span class="nx">Network</span><span class="p">.</span><span class="nx">NETWORK_NONE</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="p">};</span>

  <span class="nx">self</span><span class="p">.</span><span class="nx">showDebugAlert</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">isDebugOn</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;alloy&#39;</span><span class="p">).</span><span class="nx">CFG</span><span class="p">.</span><span class="nx">debug</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">isDebugOn</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">alert</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">self</span><span class="p">.</span><span class="nx">showAlert</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">alert</span> <span class="o">=</span> <span class="nx">Titanium</span><span class="p">.</span><span class="nx">UI</span><span class="p">.</span><span class="nx">createAlertDialog</span><span class="p">({</span>
      <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Network Rail&#39;</span><span class="p">,</span>
      <span class="nx">message</span><span class="o">:</span> <span class="nx">message</span><span class="p">,</span>
      <span class="nx">buttonNames</span><span class="o">:</span> <span class="nx">callback</span> <span class="o">?</span> <span class="p">[</span><span class="s1">&#39;OK&#39;</span><span class="p">,</span> <span class="s1">&#39;Cancel&#39;</span><span class="p">]</span> <span class="o">:</span> <span class="p">[</span><span class="s1">&#39;OK&#39;</span><span class="p">]</span>
    <span class="p">});</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">alert</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">alert</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>

  <span class="p">};</span>

  <span class="nx">self</span><span class="p">.</span><span class="nx">sliderVisible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></pre></div></td></tr><tr id="section-42"><td class="docs"><div class="pilwrap"><a href="#section-42" class="pilcrow">&#182;</a></div><p>tracks if slider is currently visible on screen</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">self</span><span class="p">.</span><span class="nx">sliderProxy</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="nx">self</span><span class="p">.</span><span class="nx">slideNotify</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">bottom</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">hideAll</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr><tr id="section-43"><td class="docs"><div class="pilwrap"><a href="#section-43" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><ul>
<li>Function will show a notifier that slides in</li>
</ul></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">win</span> <span class="o">=</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">UI</span><span class="p">.</span><span class="nx">createWindow</span><span class="p">({</span>
      <span class="nx">bottom</span><span class="o">:</span> <span class="nx">bottom</span><span class="p">,</span>
      <span class="nx">statusBarStyle</span><span class="o">:</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">UI</span><span class="p">.</span><span class="nx">iPhone</span><span class="p">.</span><span class="nx">StatusBar</span><span class="p">.</span><span class="nx">LIGHT_CONTENT</span><span class="p">,</span>
      <span class="nx">height</span><span class="o">:</span> <span class="mi">300</span>
    <span class="p">});</span>
    <span class="kd">var</span> <span class="nx">completedAnimation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">newAnimation</span> <span class="o">=</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">UI</span><span class="p">.</span><span class="nx">createAnimation</span><span class="p">();</span>
      <span class="nx">newAnimation</span><span class="p">.</span><span class="nx">duration</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
      <span class="nx">newAnimation</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="o">-</span><span class="mi">50</span><span class="p">;</span>
      <span class="nx">newAnimation</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="nx">newAnimation</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;complete&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">sliderView</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">noConnectionText</span><span class="p">);</span>
        <span class="nx">win</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">sliderView</span><span class="p">);</span>
        <span class="nx">noConnectionText</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="nx">sliderView</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">sliderVisible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">sliderProxy</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">win</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
      <span class="p">});</span>

      <span class="nx">newAnimation</span><span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="nx">sliderView</span><span class="p">);</span>
      
    <span class="p">};</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">sliderVisible</span> <span class="o">||</span> <span class="nx">hideAll</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">sliderProxy</span><span class="p">.</span><span class="nx">fireEvent</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Alloy</span><span class="p">.</span><span class="nx">Globals</span><span class="p">.</span><span class="nx">Logger</span><span class="p">.</span><span class="nx">logException</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
        <span class="nx">Ti</span><span class="p">.</span><span class="nx">API</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="s1">&#39;Error with slider click&#39;</span> <span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">e</span><span class="p">));</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">sliderVisible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">sliderView</span> <span class="o">=</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">UI</span><span class="p">.</span><span class="nx">createView</span><span class="p">({</span>
      <span class="nx">width</span><span class="o">:</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">UI</span><span class="p">.</span><span class="nx">FILL</span><span class="p">,</span>
      <span class="nx">height</span><span class="o">:</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">UI</span><span class="p">.</span><span class="nx">SIZE</span><span class="p">,</span>
      <span class="nx">zIndex</span><span class="o">:</span> <span class="mi">9999</span><span class="p">,</span>
      <span class="nx">backgroundGradient</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span>
        <span class="nx">startPoint</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">x</span><span class="o">:</span> <span class="s1">&#39;100%&#39;</span><span class="p">,</span>
          <span class="nx">y</span><span class="o">:</span> <span class="s1">&#39;0%&#39;</span>
        <span class="p">},</span>
        <span class="nx">endPoint</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">x</span><span class="o">:</span> <span class="s1">&#39;100%&#39;</span><span class="p">,</span>
          <span class="nx">y</span><span class="o">:</span> <span class="s1">&#39;100%&#39;</span>
        <span class="p">},</span>
        <span class="nx">colors</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;#b11616&#39;</span><span class="p">,</span> <span class="s1">&#39;#871d1d&#39;</span><span class="p">]</span>
      <span class="p">},</span>
      <span class="nx">bottom</span><span class="o">:</span> <span class="nx">bottom</span> <span class="o">?</span> <span class="nx">bottom</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">opacity</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">left</span><span class="o">:</span> <span class="o">-</span><span class="mi">50</span>
    <span class="p">});</span>

    <span class="kd">var</span> <span class="nx">noConnectionText</span> <span class="o">=</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">UI</span><span class="p">.</span><span class="nx">createLabel</span><span class="p">({</span>
      <span class="nx">text</span><span class="o">:</span> <span class="nx">message</span><span class="p">,</span>
      <span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span>
      <span class="nx">font</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">fontFamily</span><span class="o">:</span> <span class="s1">&#39;Helvetica&#39;</span><span class="p">,</span>
        <span class="nx">fontSize</span><span class="o">:</span> <span class="mi">18</span><span class="p">,</span>
        <span class="nx">fontWeight</span><span class="o">:</span> <span class="s1">&#39;bold&#39;</span>
      <span class="p">},</span>
      <span class="nx">top</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
      <span class="nx">bottom</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
      <span class="nx">height</span><span class="o">:</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">UI</span><span class="p">.</span><span class="nx">SIZE</span><span class="p">,</span>
      <span class="nx">textAlign</span><span class="o">:</span> <span class="s1">&#39;center&#39;</span>
    <span class="p">});</span>
    <span class="nx">sliderView</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">noConnectionText</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">animation</span> <span class="o">=</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">UI</span><span class="p">.</span><span class="nx">createAnimation</span><span class="p">();</span>
    <span class="nx">animation</span><span class="p">.</span><span class="nx">duration</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
    <span class="nx">animation</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="nx">animation</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">animationHandler</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">newAnimation</span> <span class="o">=</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">UI</span><span class="p">.</span><span class="nx">createAnimation</span><span class="p">();</span>
      <span class="nx">newAnimation</span><span class="p">.</span><span class="nx">duration</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
      <span class="nx">newAnimation</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nx">newAnimation</span><span class="p">.</span><span class="nx">backgroundGradient</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span>
        <span class="nx">startPoint</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">x</span><span class="o">:</span> <span class="s1">&#39;0%&#39;</span><span class="p">,</span>
          <span class="nx">y</span><span class="o">:</span> <span class="s1">&#39;50%&#39;</span>
        <span class="p">},</span>
        <span class="nx">endPoint</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">x</span><span class="o">:</span> <span class="s1">&#39;100%&#39;</span><span class="p">,</span>
          <span class="nx">y</span><span class="o">:</span> <span class="s1">&#39;50%&#39;</span>
        <span class="p">},</span>
        <span class="nx">colors</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;#282828&#39;</span><span class="p">,</span> <span class="s1">&#39;#1d1c1c&#39;</span><span class="p">]</span>
      <span class="p">};</span>
      <span class="nx">sliderView</span><span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="nx">newAnimation</span><span class="p">);</span>
      <span class="nx">animation</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;complete&#39;</span><span class="p">,</span> <span class="nx">animationHandler</span><span class="p">);</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">sliderVisible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">sliderProxy</span> <span class="o">=</span> <span class="nx">sliderView</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">animation</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;complete&#39;</span><span class="p">,</span> <span class="nx">animationHandler</span><span class="p">);</span>
    <span class="nx">sliderView</span><span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="nx">animation</span><span class="p">);</span>

    <span class="nx">sliderView</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">completedAnimation</span><span class="p">();</span>
    <span class="p">});</span></pre></div></td></tr><tr id="section-44"><td class="docs"><div class="pilwrap"><a href="#section-44" class="pilcrow">&#182;</a></div><p>Adding a timeout so that the animation completes after 10 seconds</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">completedAnimation</span><span class="p">,</span> <span class="mi">10000</span><span class="p">);</span>

    <span class="nx">win</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">sliderView</span><span class="p">);</span>
    <span class="nx">win</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span>
  <span class="p">};</span>


  <span class="k">return</span> <span class="nx">self</span><span class="p">;</span>

<span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">_Util</span><span class="p">();</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Mon Mar 24 2014 19:50:05 GMT+0000 (GMT)  </div></div></body></html>