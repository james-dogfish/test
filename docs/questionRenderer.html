<!DOCTYPE html>

<html>
<head>
  <title>questionRenderer.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>questionRenderer.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p><code>Alloy.Globals.currentlyFocusedTF</code> stores the currently focused textfield</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Alloy.Globals.currentlyFocusedTF = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p><code>hiddenQuestions</code> is a list of all questions that are not currently visible</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> hiddenQuestions = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p><code>allSections</code> is a list of all possible (Titanium.UI.ListSection) in a assessment</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> allSections = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p><code>currentAssessmentObject</code> defines the assessmentObject the the question renderer is displaying</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> currentAssessmentObject = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p><code>questionSelected</code> is used for the move to lastQuestion
when a question is selected this value is updated</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> questionSelected = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p><code>ALL_SECTIONS</code> and <code>SINGLE_SECTIONS</code> are just names for set values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> ALL_SECTIONS = <span class="hljs-number">1</span>;
<span class="hljs-keyword">var</span> SINGLE_SECTIONS = <span class="hljs-number">2</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><code>listViewDisplayType</code> defines what mode the question renderer is in and can be set to <code>ALL_SECTIONS</code> or <code>SINGLE_SECTIONS</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> listViewDisplayType = ALL_SECTIONS;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p><code>currentSingleSectionIndex</code> is the index of the section curently selected section,
when <code>listViewDisplayType</code> is set to <code>SINGLE_SECTIONS</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> currentSingleSectionIndex = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p><code>findQuestionsRef</code> searches sectionList for a question that 
matches the questionName and groupType and returns references to the found question.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param sectionList : (Titanium.UI.ListSection) the list of sections to search in
 * @param questionName : (string) Name to search against
 * @param groupType : (string) groupType to search against
 * 
 * @returns - success :  Object { (int)questionIndex, questionObject, (Titanium.UI.ListSection) sectionObject}
 * @returns - fail : null
 */</span>
<span class="hljs-keyword">var</span> findQuestionsRef = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(sectionList, questionName, groupType)</span> {</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> sectionIndex = <span class="hljs-number">0</span>; sectionIndex &lt; sectionList.length; sectionIndex++) {
		
		<span class="hljs-keyword">if</span>(sectionList[sectionIndex].groupType == groupType){
			<span class="hljs-keyword">var</span> itemsList = sectionList[sectionIndex].getItems();
	        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> itemIndex = <span class="hljs-number">0</span>; itemIndex &lt; itemsList.length; itemIndex++) {
	            <span class="hljs-keyword">if</span> (itemsList[itemIndex].name == questionName) {
	                <span class="hljs-keyword">return</span> {
	                    questionIndex: itemIndex,
	                    question: itemsList[itemIndex],
	                    section: sectionList[sectionIndex]
	                };
	            }
	        }
       }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p><code>newTestIfMandatory</code> the questionObject passed in will be tested if it is mandatory.
A question can be strictly  mandatory or can be mandatory depending on the
value of anther question.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param questionObject : questionObject to test
 * 
 * @returns :  true or false
 */</span>
<span class="hljs-keyword">var</span> newTestIfMandatory = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(questionObject)</span> {</span>

    <span class="hljs-keyword">if</span> (questionObject.validation.mandatory == <span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (questionObject.validation.conditionalMandatory.length == <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">var</span> conditionalMandatory = questionObject.validation.conditionalMandatory;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> conditionalIndex = <span class="hljs-number">0</span>; conditionalIndex &lt; conditionalMandatory.length; conditionalIndex++) {
        <span class="hljs-keyword">var</span> parentQuestion = newFindQuestionObject(conditionalMandatory[conditionalIndex].question.name, conditionalMandatory[conditionalIndex].question.groupType);
        <span class="hljs-keyword">if</span> (parentQuestion == <span class="hljs-literal">null</span>) <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">if</span> (conditionalMandatory[conditionalIndex].value == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> valueIndex = <span class="hljs-number">0</span>; valueIndex &lt; parentQuestion.value.length; valueIndex++) {
            <span class="hljs-keyword">if</span> (conditionalMandatory[conditionalIndex].value == parentQuestion.value[valueIndex]) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><code>setQuestionToMandatory</code> the question passed in will have its title changed to
have a ‘*’ at its end if it is mandatory or removed if it is not</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param questionObject : questionObject to be changed
 * 
 * @returns :  questionObject
 */</span>
<span class="hljs-keyword">var</span> setQuestionToMandatory = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(questionObject)</span> {</span>
    <span class="hljs-keyword">if</span> (questionObject.mandatory == <span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">if</span> (questionObject.title.text.slice(-<span class="hljs-number">1</span>) != <span class="hljs-string">"*"</span>) {
            questionObject.title.text = questionObject.title.text + <span class="hljs-string">"*"</span>;
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (questionObject.title.text.slice(-<span class="hljs-number">1</span>) == <span class="hljs-string">"*"</span>) {
            questionObject.title.text = questionObject.title.text.substring(<span class="hljs-number">0</span>, questionObject.title.text.length - <span class="hljs-number">1</span>);
        }
    }

    <span class="hljs-keyword">return</span> questionObject;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><code>newTestIfVisable</code> questionObject passed in will be tested if it should be Visible
to the user or hidden</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param questionObject : questionObject to test
 * 
 * @returns :  true or false
 */</span>
<span class="hljs-keyword">var</span> newTestIfVisable = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(questionObject)</span> {</span>

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> renderValueIndex = <span class="hljs-number">0</span>; renderValueIndex &lt; questionObject.renderValue.length; renderValueIndex++) {
        <span class="hljs-keyword">var</span> parentQuestion = newFindQuestionObject(questionObject.renderValue[renderValueIndex].question.name, questionObject.renderValue[renderValueIndex].question.groupType);
        <span class="hljs-keyword">if</span> (parentQuestion == <span class="hljs-literal">null</span>) <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">if</span> (questionObject.renderValue[renderValueIndex].value == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> valueIndex = <span class="hljs-number">0</span>; valueIndex &lt; parentQuestion.value.length; valueIndex++) {
            <span class="hljs-keyword">if</span> (questionObject.renderValue[renderValueIndex].value == parentQuestion.value[valueIndex]) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p><code>newFindQuestionObject</code> this function searches all sections for a question that 
matches the questionName and groupType and return the question Object or null 
if not found</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param questionName : (string) Name to search against
 * @param groupType : (string) groupType to search against
 * 
 * @returns - success :  questionObject
 * @returns - fail : null
 */</span>
<span class="hljs-keyword">var</span> newFindQuestionObject = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(questionName, groupType)</span> {</span>
    <span class="hljs-keyword">var</span> sectionList = getAllQuestionSections();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> sectionIndex = <span class="hljs-number">0</span>; sectionIndex &lt; sectionList.length; sectionIndex++) {

        <span class="hljs-keyword">if</span> (sectionList[sectionIndex].groupType == groupType) {
            <span class="hljs-keyword">var</span> questionList = sectionList[sectionIndex].getItems();
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> questionIndex = <span class="hljs-number">0</span>; questionIndex &lt; questionList.length; questionIndex++) {
                <span class="hljs-keyword">if</span> (questionList[questionIndex].name == questionName) {
                    <span class="hljs-keyword">return</span> questionList[questionIndex];
                }
            }
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p><code>newTestDependentQuestions</code> tests all questions that are dependent on the passed
questionObject if they are visable or mandatory. question are hiden or made Visible
depending on the results of the tests</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param questionObject : questionObject to test
 * 
 * @returns :  n/a
 */</span>
<span class="hljs-keyword">var</span> newTestDependentQuestions = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(questionObject)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p><code>addToSectionMap</code>is a map of section using groupType as a key to a list of questions to add to that section</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> addToSectionMap = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> questionIndex = <span class="hljs-number">0</span>; questionIndex &lt; hiddenQuestions.length; questionIndex++) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> childQuestionIndex = <span class="hljs-number">0</span>; childQuestionIndex &lt; questionObject.renderDependencyList.length; childQuestionIndex++) {
			<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> hiddenQuestions[questionIndex].name === <span class="hljs-string">"undefined"</span>)
			{
				<span class="hljs-keyword">continue</span>;
			}
            <span class="hljs-keyword">if</span> (hiddenQuestions[questionIndex].name == questionObject.renderDependencyList[childQuestionIndex].name) {
            	
                <span class="hljs-keyword">if</span> (newTestIfVisable(hiddenQuestions[questionIndex]) == <span class="hljs-literal">true</span>) {
                	
                    <span class="hljs-keyword">if</span> (!(hiddenQuestions[questionIndex].groupType <span class="hljs-keyword">in</span> addToSectionMap)) {
                    	
                        addToSectionMap[hiddenQuestions[questionIndex].groupType] = [];
                    }
                    addToSectionMap[hiddenQuestions[questionIndex].groupType].push(hiddenQuestions[questionIndex]);
                    hiddenQuestions.splice(questionIndex, <span class="hljs-number">1</span>);
                    questionIndex--;
                }
            }
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p><code>removeFromSectionMap</code> is a map of section with groupType being the key. each element in the map is a second map of question names.
using this <code>if(questionName in removeFromSectionMap[groupType]</code> will tell you if the question needs to be removed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> removeFromSectionMap = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> questionIndex = <span class="hljs-number">0</span>; questionIndex &lt; questionObject.renderDependencyList.length; questionIndex++) {
        <span class="hljs-keyword">var</span> childQuestion = newFindQuestionObject(questionObject.renderDependencyList[questionIndex].name, questionObject.renderDependencyList[questionIndex].groupType);
        <span class="hljs-keyword">if</span> (childQuestion == <span class="hljs-literal">null</span>) <span class="hljs-keyword">continue</span>;

        <span class="hljs-keyword">if</span> (newTestIfVisable(childQuestion) == <span class="hljs-literal">false</span>) {
            <span class="hljs-keyword">if</span> (!(childQuestion.groupType <span class="hljs-keyword">in</span> removeFromSectionMap)) {
                removeFromSectionMap[childQuestion.groupType] = [];
            }
            removeFromSectionMap[childQuestion.groupType][childQuestion.name] = <span class="hljs-literal">true</span>;
        }
    }

    <span class="hljs-keyword">var</span> sectionList = getAllQuestionSections();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> sectionIndex = <span class="hljs-number">0</span>; sectionIndex &lt; sectionList.length; sectionIndex++) {

        <span class="hljs-keyword">var</span> questionList = sectionList[sectionIndex].getItems();
        <span class="hljs-keyword">var</span> sectionGroupType = sectionList[sectionIndex].groupType;</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p><code>if (sectionGroupType in removeFromSectionMap)</code> tests if there are any question that need to be removed </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (sectionGroupType <span class="hljs-keyword">in</span> removeFromSectionMap) {
            Alloy.Globals.Logger.log(<span class="hljs-string">"remove from section : "</span> + sectionGroupType,<span class="hljs-string">"info"</span>);

            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> questionIndex = <span class="hljs-number">0</span>; questionIndex &lt; questionList.length; questionIndex++) {
                <span class="hljs-keyword">if</span> (questionList[questionIndex].name <span class="hljs-keyword">in</span> removeFromSectionMap[sectionGroupType]) {
                    Alloy.Globals.Logger.log(<span class="hljs-string">"remove : "</span> + questionList[questionIndex].title.text,<span class="hljs-string">"info"</span>);
                    questionList[questionIndex].visable = <span class="hljs-literal">false</span>;

                    questionList[questionIndex].mandatory = newTestIfMandatory(questionList[questionIndex]);
                    questionList[questionIndex] = setQuestionToMandatory(questionList[questionIndex]);

                    Alloy.Globals.localDataHandler.updateQuestion(questionList[questionIndex]);
                    hiddenQuestions.push(questionList[questionIndex]);
                    questionList.splice(questionIndex, <span class="hljs-number">1</span>);

                    questionIndex--;
                }
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p><code>if (sectionGroupType in addToSectionMap)</code> tests if there are any question that need to be added </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (sectionGroupType <span class="hljs-keyword">in</span> addToSectionMap) {
            Alloy.Globals.Logger.log(<span class="hljs-string">"add from section : "</span> + sectionGroupType,<span class="hljs-string">"info"</span>);

            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> addQuestionIndex = <span class="hljs-number">0</span>; addQuestionIndex &lt; addToSectionMap[sectionGroupType].length; addQuestionIndex++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>will now add the question in the section depending on there order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> questionObjectToAdd = addToSectionMap[sectionGroupType][addQuestionIndex];
                <span class="hljs-keyword">var</span> questionAdded = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> questionIndex = <span class="hljs-number">0</span>; questionIndex &lt; questionList.length &amp;&amp; questionAdded != <span class="hljs-literal">true</span>; questionIndex++) {

                    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">parseInt</span>(questionObjectToAdd.order) &lt; <span class="hljs-built_in">parseInt</span>(questionList[questionIndex].order)) {

                        questionObjectToAdd.visable = <span class="hljs-literal">true</span>;

                        questionObjectToAdd.mandatory = newTestIfMandatory(questionObjectToAdd);
                        questionObjectToAdd = setQuestionToMandatory(questionObjectToAdd);
     

                        Alloy.Globals.localDataHandler.updateQuestion(questionObjectToAdd);


                        questionList.splice(questionIndex, <span class="hljs-number">0</span>, questionObjectToAdd);
                        Alloy.Globals.Logger.log(<span class="hljs-string">"added splice : "</span> + questionObjectToAdd.title.text,<span class="hljs-string">"info"</span>);
                        questionAdded = <span class="hljs-literal">true</span>;
                    }
                }
                <span class="hljs-keyword">if</span> (questionAdded == <span class="hljs-literal">false</span>) {
                    questionObjectToAdd.visable = <span class="hljs-literal">true</span>;

                    questionObjectToAdd.mandatory = newTestIfMandatory(questionObjectToAdd);
                    questionObjectToAdd = setQuestionToMandatory(questionObjectToAdd);

                    Alloy.Globals.localDataHandler.updateQuestion(questionObjectToAdd);
                    questionList.push(questionObjectToAdd);
                    Alloy.Globals.Logger.log(<span class="hljs-string">"added push : "</span> + questionObjectToAdd.title.text,<span class="hljs-string">"info"</span>);
                }
            }
        }

        <span class="hljs-keyword">if</span> (sectionGroupType <span class="hljs-keyword">in</span> addToSectionMap || sectionGroupType <span class="hljs-keyword">in</span> removeFromSectionMap) {
            sectionList[sectionIndex].setItems(questionList);
            
            <span class="hljs-keyword">if</span>(questionList.length &gt; <span class="hljs-number">0</span>){
	        	sectionList[sectionIndex].headerView.show();
	        	sectionList[sectionIndex].headerView.height = Ti.UI.SIZE;
	        }
	        <span class="hljs-keyword">else</span>{
	        	sectionList[sectionIndex].headerView.hide();
	        	sectionList[sectionIndex].headerView.height = <span class="hljs-number">0</span>;
	        }
        }
    }


    <span class="hljs-keyword">var</span> testMandatorySectionMap = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> questionIndex = <span class="hljs-number">0</span>; questionIndex &lt; questionObject.mandatoryDependenciesList.length; questionIndex++) {
        <span class="hljs-keyword">var</span> childQuestion = newFindQuestionObject(questionObject.mandatoryDependenciesList[questionIndex].name, questionObject.mandatoryDependenciesList[questionIndex].groupType);
        <span class="hljs-keyword">if</span> (childQuestion == <span class="hljs-literal">null</span>) <span class="hljs-keyword">continue</span>;

        <span class="hljs-keyword">if</span> (!(childQuestion.groupType <span class="hljs-keyword">in</span> testMandatorySectionMap)) {
            testMandatorySectionMap[childQuestion.groupType] = [];
        }
        testMandatorySectionMap[childQuestion.groupType][childQuestion.name] = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> sectionIndex = <span class="hljs-number">0</span>; sectionIndex &lt; sectionList.length; sectionIndex++) {
        <span class="hljs-keyword">var</span> questionList = sectionList[sectionIndex].getItems();
        <span class="hljs-keyword">var</span> sectionGroupType = sectionList[sectionIndex].groupType;

        <span class="hljs-keyword">if</span> (sectionGroupType <span class="hljs-keyword">in</span> testMandatorySectionMap) {
   

            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> questionIndex = <span class="hljs-number">0</span>; questionIndex &lt; questionList.length; questionIndex++) {
                <span class="hljs-keyword">if</span> (questionList[questionIndex].name <span class="hljs-keyword">in</span> testMandatorySectionMap[sectionGroupType]) {
                    questionList[questionIndex].mandatory = newTestIfMandatory(questionList[questionIndex]);
                    questionList[questionIndex] = setQuestionToMandatory(questionList[questionIndex]);
                    Alloy.Globals.localDataHandler.updateQuestion(questionList[questionIndex]);
                }
            }

            sectionList[sectionIndex].setItems(questionList);

        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p><code>findQuestionsValue</code> searches for the question that matches the 
passed questionName, then the question value array is returned. if no question is
found it returns an array with a empty String in</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param questionName : (string) Name to search against
 * 
 * @returns - success :  value List eg ["value1", "value2"]
 * @returns - fail : list with one item [""]
 */</span>
<span class="hljs-keyword">var</span> findQuestionsValue = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(questionName)</span> {</span>
    <span class="hljs-keyword">var</span> sectionList = getAllQuestionSections();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> sectionIndex = <span class="hljs-number">0</span>; sectionIndex &lt; sectionList.length; sectionIndex++) {

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> questionIndex = <span class="hljs-number">0</span>; questionIndex &lt; sectionList[sectionIndex].getItems().length; questionIndex++) {
            <span class="hljs-keyword">var</span> questionList = sectionList[sectionIndex].getItems();

            <span class="hljs-keyword">if</span> (questionList[questionIndex].name == questionName) {
                <span class="hljs-keyword">return</span> questionList[questionIndex].value;
            }
        }
    }
    <span class="hljs-keyword">return</span> [<span class="hljs-string">""</span>];
};</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p><code>findSectionByAssociatedFileName</code> searches for the question that matches the 
passed alcrmQuestionID that also is found is the file that matches associatedFileName.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param alcrmQuestionID : (string) alcrmQuestionID to search for
 * @param associatedFileName : (string) associatedFileName to search for
 * 
 * @returns - success :  Object {questionIndex, questionObject, sectionObject}
 * @returns - fail : null
 */</span>
<span class="hljs-keyword">var</span> findQuestionByAssociatedFileName = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(alcrmQuestionID, associatedFileName)</span> {</span>
    <span class="hljs-keyword">var</span> sectionList = getAllQuestionSections();

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> sectionIndex = <span class="hljs-number">0</span>; sectionIndex &lt; sectionList.length; sectionIndex++) {
    	
        <span class="hljs-keyword">if</span> (sectionList[sectionIndex].associatedFileName == associatedFileName) {
            <span class="hljs-keyword">var</span> questionList = sectionList[sectionIndex].getItems();
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> questionIndex = <span class="hljs-number">0</span>; questionIndex &lt; questionList.length; questionIndex++) {
                <span class="hljs-keyword">if</span> (questionList[questionIndex].alcrmQuestionID == alcrmQuestionID) {

                    <span class="hljs-keyword">return</span> {
                    	questionIndex: questionIndex,
                        question: questionList[questionIndex],
                        section: sectionList[sectionIndex]
                    };
                }
            }
        }
    }
    Alloy.Globals.Logger.log(<span class="hljs-string">"findQuestionByAssociatedFileName question not found, alcrmQuestionID = "</span>+alcrmQuestionID+<span class="hljs-string">", associatedFileName = "</span>+associatedFileName, <span class="hljs-string">"error"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p><code>findSectionByAssociatedFileName</code> searches for the section that matches the 
passed alcrmGroupType that also is found is the file that matches associatedFileName.
the fuction will return the section object or null if not found</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param alcrmGroupType :(string) alcrmGroupType to search for
 * @param associatedFileName : (string) associatedFileName to search for
 * 
 * @returns - success :  (Titanium.UI.ListSection) sectionObject
 * @returns - fail : null
 */</span>
<span class="hljs-keyword">var</span> findSectionByAssociatedFileName = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(alcrmGroupType, associatedFileName)</span> {</span>
    <span class="hljs-keyword">var</span> sectionList = getAllQuestionSections();

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> sectionIndex = <span class="hljs-number">0</span>; sectionIndex &lt; sectionList.length; sectionIndex++) {

        <span class="hljs-keyword">if</span> (sectionList[sectionIndex].associatedFileName == associatedFileName &amp;&amp; sectionList[sectionIndex].alcrmGroupType == alcrmGroupType) {
            <span class="hljs-keyword">return</span> sectionList[sectionIndex];
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p><code>exports.clear</code> clears all sections and questions from the listView</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*** * 
 * @returns : n/a
 */</span>
exports.clear = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    allSections = [];
    $.listView.setSections(allSections);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p><code>buildQuestionSections</code> takes the JASON_sectionList and builds titanium
ListSection for each section and return the new list of titanium ListSections</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param JASON_sectionList : simple JSON List of Sections and Question
 * 
 * @returns :  (Titanium.UI.ListSection)  listSections
 */</span>
<span class="hljs-keyword">var</span> buildQuestionSections = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(JASON_sectionList)</span> {</span>
    <span class="hljs-keyword">var</span> newSectionList = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; JASON_sectionList.length; i++) {
        <span class="hljs-keyword">var</span> newQuestionsSection = Titanium.UI.createListSection();

        <span class="hljs-keyword">if</span> (JASON_sectionList[i].pageType == <span class="hljs-string">"riskAssessment"</span>) {
            newQuestionsSection.headerView = Alloy.createController(<span class="hljs-string">"questionSectionHeader"</span>, {
                title: JASON_sectionList[i].title
            }).getView();
        } <span class="hljs-keyword">else</span> {
            newQuestionsSection.headerView = Alloy.createController(<span class="hljs-string">"questionSectionHeader"</span>, {
                title: JASON_sectionList[i].pageName + <span class="hljs-string">" "</span> + JASON_sectionList[i].title
            }).getView();
        }

        newQuestionsSection.title = JASON_sectionList[i].title;
        newQuestionsSection.groupType = JASON_sectionList[i].groupType;
        newQuestionsSection.alcrmGroupType = JASON_sectionList[i].alcrmGroupType;
        newQuestionsSection.associatedFileName = JASON_sectionList[i].associatedFileName;
        newQuestionsSection.pageName = JASON_sectionList[i].pageName;
        newQuestionsSection.pageType = JASON_sectionList[i].pageType;
       	newQuestionsSection.pageID= JASON_sectionList[i].pageID;
        newQuestionsSection.setItems(JASON_sectionList[i].questionList);
        newSectionList.push(newQuestionsSection);
        
        <span class="hljs-keyword">if</span>(JASON_sectionList[i].questionList.length == <span class="hljs-number">0</span>){
        	newQuestionsSection.headerView.hide();
        	newQuestionsSection.headerView.height = <span class="hljs-number">0</span>;
        }
    }
    <span class="hljs-keyword">return</span> newSectionList;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p><code>removeHiddenQuestions</code> takes the JASON_sectionList removes all hidden questions
before the function buildQuestionSections is called. all hidden questions are added to
hiddenQuestions list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param JASON_sectionList : simple JSON List of Sections and Question
 * 
 * @returns :  JASON_sectionList - with hidden questions removed
 */</span>
<span class="hljs-keyword">var</span> removeHiddenQuestions = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(JASON_sectionList)</span> {</span>
	<span class="hljs-keyword">try</span>{
	    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> sectionIndex = <span class="hljs-number">0</span>; sectionIndex &lt; JASON_sectionList.length; sectionIndex++) {

	        <span class="hljs-keyword">var</span> questionList = JASON_sectionList[sectionIndex].questionList;
	        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> questionIndex = <span class="hljs-number">0</span>; questionIndex &lt; questionList.length; questionIndex++) {
	        	
				<span class="hljs-keyword">if</span>(questionList[questionIndex] != <span class="hljs-literal">null</span>){
		            <span class="hljs-keyword">if</span> (questionList[questionIndex].visable == <span class="hljs-literal">false</span>) {
		            	Alloy.Globals.Logger.log(<span class="hljs-string">"removeHiddenQuestion at start, question name = "</span>+questionList[questionIndex].name,<span class="hljs-string">"info"</span>);
		                hiddenQuestions.push(questionList[questionIndex]);
		                questionList.splice(questionIndex, <span class="hljs-number">1</span>);
		                questionIndex = questionIndex - <span class="hljs-number">1</span>;
		            }
		            
		       }
	        }
	        JASON_sectionList.questionList = questionList;
	    }
	    <span class="hljs-keyword">return</span> JASON_sectionList;
	}<span class="hljs-keyword">catch</span>(e){
		Alloy.Globals.Logger.log(<span class="hljs-string">"Exception in removeHiddenQuestions. Error Details: "</span>+<span class="hljs-built_in">JSON</span>.stringify(e), <span class="hljs-string">"error"</span>);
		Alloy.Globals.aIndicator.hide();
	}
};</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p><code>setupSelectedQuestion</code> called within the function setAssessment. it searches for the
a question that has been previously selected or if non found the first non read-only question</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @returns : n/a
 */</span>
<span class="hljs-keyword">var</span> setupSelectedQuestion = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
 <span class="hljs-keyword">try</span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> sectionIndex = <span class="hljs-number">0</span>; sectionIndex &lt; allSections.length; sectionIndex++) {
        <span class="hljs-keyword">var</span> questionList = allSections[sectionIndex].getItems();
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> questionIndex = <span class="hljs-number">0</span>; questionIndex &lt; questionList.length; questionIndex++) {
        	<span class="hljs-keyword">if</span>(questionList[questionIndex] != <span class="hljs-literal">null</span>){
	            <span class="hljs-keyword">if</span> (questionList[questionIndex].selected == <span class="hljs-literal">true</span>) {
	                selectQuestion(questionList[questionIndex]);
	                <span class="hljs-keyword">return</span>;
	            }
	        }
        }
    }


    <span class="hljs-keyword">if</span> (allSections.length &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">var</span> questionList = allSections[<span class="hljs-number">0</span>].getItems();
        <span class="hljs-keyword">if</span> (questionList &gt; <span class="hljs-number">0</span>) {
            selectQuestion(questionList[<span class="hljs-number">0</span>]);
        }
    }
 }<span class="hljs-keyword">catch</span>(e){
 	Alloy.Globals.Logger.log(<span class="hljs-string">"Exception in setupSelectedQuestion. Error Details: "</span>+<span class="hljs-built_in">JSON</span>.stringify(e), <span class="hljs-string">"error"</span>);
	Alloy.Globals.aIndicator.hide();
 }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p><code>setAssessment</code> the JASON_sectionList is the interpreted question set and assessmentObject
is the saved assessment object created in localDataHandler. this function is used to setup 
questionRenderer to veiw an assessment</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param JASON_sectionList : simple JSON List of Sections and Question
 * @param assessmentObject : object defining an assessment and names of attched saved files
 * 
 * @returns - n/a
 */</span>
exports.setAssessment = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(JASON_sectionList, assessmentObject)</span> {</span>
	<span class="hljs-keyword">try</span>{
		Ti.API.info(<span class="hljs-string">"setAssessment = "</span>+<span class="hljs-built_in">JSON</span>.stringify(JASON_sectionList));
		$.listView.setSections([]);
	    currentAssessmentObject = assessmentObject;
	
	    hiddenQuestions = [];
	    allSections = [];
	
	    JASON_sectionList = removeHiddenQuestions(JASON_sectionList);
	
		
	
	    sectionList = buildQuestionSections(JASON_sectionList);
	
	    allSections = sectionList;
	
	    $.listView.setSections(sectionList);
	    
	    <span class="hljs-keyword">var</span> userPreferences = Alloy.Globals.User.getPreferences();
	    setListViewDisplayTypeToSingleSections(userPreferences.singleView);
		userPreferences = <span class="hljs-literal">null</span>;
		
	    setupSelectedQuestion();
	
	    $.listView.scrollToItem(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
	}<span class="hljs-keyword">catch</span>(e){
		Alloy.Globals.Logger.log(<span class="hljs-string">"Exception in setAssessment. Error Details: "</span>+<span class="hljs-built_in">JSON</span>.stringify(e), <span class="hljs-string">"error"</span>);
		Alloy.Globals.aIndicator.hide();
	}
};</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p><code>appendSectionsToAssessment</code> the JASON_sectionList is the interpreted question.
used to add extra sectons to the listView after setAssessment has been called</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param JASON_sectionList : simple JSON List of Sections and Question
 * 
 * @returns - n/a
 */</span>
exports.appendSectionsToAssessment = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(JASON_sectionList)</span> {</span>
	Ti.API.info(<span class="hljs-string">"appendSectionsToAssessment = "</span>+<span class="hljs-built_in">JSON</span>.stringify(JASON_sectionList));
    JASON_sectionList = removeHiddenQuestions(JASON_sectionList);

    appendSectionList = buildQuestionSections(JASON_sectionList);

    allSections = allSections.concat(appendSectionList);
    $.listView.setSections(allSections);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p><code>exports.moveToQuestion</code> searches for a section that matched the groupType
and moves the listView to make visble the question at questionIndex at the top of the screen</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param groupType : (string) groupType to search for
 * @param questionIndex : (int) questionIndex to search for
 * 
 * @returns - n/a
 */</span>
exports.moveToQuestion = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(groupType, questionIndex)</span> {</span>
    Alloy.Globals.Logger.log(<span class="hljs-string">"** questionRender moveToQuestion, groupType = "</span>+groupType+<span class="hljs-string">", questionIndex = "</span>+questionIndex,<span class="hljs-string">"info"</span>);
    <span class="hljs-keyword">var</span> sectionList = getAllQuestionSections();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> sectionIndex = <span class="hljs-number">0</span>; sectionIndex &lt; sectionList.length; sectionIndex++) {

        <span class="hljs-keyword">if</span> (sectionList[sectionIndex].groupType == groupType) {

            <span class="hljs-keyword">if</span> (listViewDisplayType == ALL_SECTIONS) {
                $.listView.scrollToItem(sectionIndex, questionIndex, {
                    animated: <span class="hljs-literal">false</span>,
                    position: Titanium.UI.iPhone.ListViewScrollPosition.TOP
                });
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (listViewDisplayType == SINGLE_SECTIONS) {
                setSelectedSectionForSingleSections(sectionIndex);
                $.listView.scrollToItem(sectionIndex, questionIndex, {
                    animated: <span class="hljs-literal">false</span>,
                    position: Titanium.UI.iPhone.ListViewScrollPosition.TOP
                });
            }

            selectQuestion(sectionList[sectionIndex].getItemAt(questionIndex));

            <span class="hljs-keyword">return</span>;
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p><code>getQuestionIndexFromSection</code> returns the index of the question that matches the questionName
in the section that is passed. if no question is found null is returned</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param questionName : (string) questionName to search for
 * @param section : (Titanium.UI.ListSection) section to search in
 * 
 * @returns - success :  (int) question index
 * @returns - fail : null
 */</span>
<span class="hljs-keyword">var</span> getQuestionIndexFromSection = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(questionName, section)</span> {</span>

    <span class="hljs-keyword">var</span> questionList = section.getItems();

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> questionIndex = <span class="hljs-number">0</span>; questionIndex &lt; questionList.length; questionIndex++) {
        <span class="hljs-keyword">if</span> (questionList[questionIndex].name == questionName) {
            <span class="hljs-keyword">return</span> questionIndex;
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p><code>moveToQuestionByName</code> move the list view to place the question found that matches questionName
and groupType at the top of the screen</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param questionName : (string) questionName to search for
 * @param groupType : (string) groupType to search for
 * 
 * @returns - n/a
 */</span>
<span class="hljs-keyword">var</span> moveToQuestionByName = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(questionName, groupType)</span> {</span>

    <span class="hljs-keyword">var</span> sectionList = getAllQuestionSections();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> sectionIndex = <span class="hljs-number">0</span>; sectionIndex &lt; sectionList.length; sectionIndex++) {

        <span class="hljs-keyword">if</span> (sectionList[sectionIndex].groupType == groupType) {

            <span class="hljs-keyword">var</span> questionIndex = getQuestionIndexFromSection(questionName, sectionList[sectionIndex]);
            
            <span class="hljs-keyword">if</span> (questionIndex == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;

            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (listViewDisplayType == ALL_SECTIONS) {
                $.listView.scrollToItem(sectionIndex, questionIndex, {
                    animated: <span class="hljs-literal">false</span>,
                    position: Titanium.UI.iPhone.ListViewScrollPosition.TOP
                });
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (listViewDisplayType == SINGLE_SECTIONS) {
                setSelectedSectionForSingleSections(sectionIndex);
                $.listView.scrollToItem(sectionIndex, questionIndex, {
                    animated: <span class="hljs-literal">false</span>,
                    position: Titanium.UI.iPhone.ListViewScrollPosition.TOP
                });
            }
            selectQuestion(sectionList[sectionIndex].getItemAt(questionIndex));

            <span class="hljs-keyword">return</span>;
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p><code>exports.goToFirstUnanswered</code> searches for the first question that has not been answered and
moves the listView so the question is at the top of the sceeen</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @returns - n/a
 */</span>
exports.goToFirstUnanswered = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> sectionList = getAllQuestionSections();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> sectionIndex = <span class="hljs-number">0</span>; sectionIndex &lt; sectionList.length; sectionIndex++) {
    	
    	<span class="hljs-keyword">if</span>(sectionList[sectionIndex].pageType == <span class="hljs-string">"coreQuestion"</span>)<span class="hljs-keyword">continue</span>;
    	
        <span class="hljs-keyword">var</span> questionList = sectionList[sectionIndex].getItems();
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> questionIndex = <span class="hljs-number">0</span>; questionIndex &lt; questionList.length; questionIndex++) {
            <span class="hljs-keyword">if</span> (questionList[questionIndex].value[<span class="hljs-number">0</span>] == <span class="hljs-string">""</span>) {
            	
                selectQuestion(questionList[questionIndex]);

                <span class="hljs-keyword">if</span> (listViewDisplayType == ALL_SECTIONS) {
                    $.listView.scrollToItem(sectionIndex, questionIndex, {
                    animated: <span class="hljs-literal">false</span>,
                    position: Titanium.UI.iPhone.ListViewScrollPosition.TOP
                });
                
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (listViewDisplayType == SINGLE_SECTIONS) {
                    setSelectedSectionForSingleSections(sectionIndex);
                    $.listView.scrollToItem(sectionIndex, questionIndex, {
	                    animated: <span class="hljs-literal">false</span>,
	                    position: Titanium.UI.iPhone.ListViewScrollPosition.TOP
	                });
                }
                <span class="hljs-keyword">return</span>;
            }
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p><code>exports.goToLastPositiond</code> searches for the first question that has not been a</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @returns - n/a
 */</span>
exports.goToLastPositiond = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    moveToQuestionByName(questionSelected.name, questionSelected.groupType);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p><code>exports.getGoToContentsDetails</code> builds a list of all sections and questions to be used in the goTo window</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @returns - list of new section objects which contain list of new question objects
 */</span>
exports.getGoToContentsDetails = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> sectionContentsDetailsList = [];
    <span class="hljs-keyword">var</span> sectionList = getAllQuestionSections();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> sectionIndex = <span class="hljs-number">0</span>; sectionIndex &lt; sectionList.length; sectionIndex++) {
    	
    	<span class="hljs-keyword">var</span> mandatoryQuestion = <span class="hljs-literal">false</span>;
 
        <span class="hljs-keyword">var</span> newSectionContents = {
            questionList: [],
            title: sectionList[sectionIndex].title,
            associatedFileName: sectionList[sectionIndex].associatedFileName,
            pageName: sectionList[sectionIndex].pageName,
            pageType: sectionList[sectionIndex].pageType,
            pageID : sectionList[sectionIndex].pageID,
            
            mandatoryQuestions : <span class="hljs-literal">false</span>,
            allMandatoryQuestionsAnswered : <span class="hljs-literal">true</span>,
            allQuestionsAnswered : <span class="hljs-literal">true</span>,
            
            sectionIndex: sectionIndex,
            groupType: sectionList[sectionIndex].groupType
        };
        <span class="hljs-keyword">if</span> (sectionList[sectionIndex].getItems().length != <span class="hljs-number">0</span>) {
            sectionContentsDetailsList.push(newSectionContents);
        }

        <span class="hljs-keyword">var</span> questionsList = sectionList[sectionIndex].getItems();
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> questionIndex = <span class="hljs-number">0</span>; questionIndex &lt; questionsList.length; questionIndex++) {
		
            <span class="hljs-keyword">if</span> (questionsList[questionIndex].isAQuestion == <span class="hljs-literal">false</span>) {
                <span class="hljs-keyword">continue</span>;
            }
            
            <span class="hljs-keyword">if</span>(questionsList[questionIndex].mandatory == <span class="hljs-literal">true</span>){
            	newSectionContents.mandatoryQuestions = <span class="hljs-literal">true</span>;
            	<span class="hljs-keyword">if</span>(questionsList[questionIndex].value[<span class="hljs-number">0</span>] == <span class="hljs-string">""</span>){
            		newSectionContents.allMandatoryQuestionsAnswered = <span class="hljs-literal">false</span>;
            		newSectionContents.allQuestionsAnswered = <span class="hljs-literal">false</span>;
            	}
            }
            <span class="hljs-keyword">else</span>{
            	<span class="hljs-keyword">if</span>(questionsList[questionIndex].value[<span class="hljs-number">0</span>] == <span class="hljs-string">""</span>){
            		newSectionContents.allQuestionsAnswered = <span class="hljs-literal">false</span>;
            	}
            }

            <span class="hljs-keyword">var</span> newQuestionDetails = {
                title: questionsList[questionIndex].title.text,
                questionIndex: questionIndex,
                mandatory: questionsList[questionIndex].mandatory,
                firstValue: questionsList[questionIndex].value[<span class="hljs-number">0</span>]
            };

            newSectionContents.questionList.push(newQuestionDetails);
        }

    }
    <span class="hljs-keyword">return</span> sectionContentsDetailsList;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p><code>getAllQuestionSections</code> returns a list of all sections in the assessment</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @/returns - list of (Titanium.UI.ListSection) 
 */</span>
<span class="hljs-keyword">var</span> getAllQuestionSections = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">return</span> allSections;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p><code>setSelectedSectionForSingleSections</code> takes a section from the allSections list and sets it to be the single visable section</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param sectionsIndex : (int) the index of the section in the sectionList
 * 
 * @/returns - n/a
 */</span>
<span class="hljs-keyword">var</span> setSelectedSectionForSingleSections = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(sectionsIndex)</span> {</span>
    currentSingleSectionIndex = sectionsIndex;
    <span class="hljs-keyword">var</span> newSectionList = [];
    newSectionList[<span class="hljs-number">0</span>] = allSections[sectionsIndex];
   
    $.backButton.visible = (sectionsIndex &gt; <span class="hljs-number">0</span>);
    $.nextButton.visible = (sectionsIndex &lt; (allSections.length - <span class="hljs-number">1</span>));

    $.listView.setSections(newSectionList);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p><code>setListViewDisplayTypeToSingleSections</code> toogles the listViewDisplayType to be SINGLE_SECTIONS or ALL_SECTIONS</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param onSingleSection : (boolean) if the SingleSection is on
 * 
 * @/returns - n/a
 */</span>
<span class="hljs-keyword">var</span> setListViewDisplayTypeToSingleSections = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(onSingleSection)</span> {</span>

    <span class="hljs-keyword">if</span> (onSingleSection == <span class="hljs-literal">true</span>) {
        listViewDisplayType = SINGLE_SECTIONS;
        <span class="hljs-keyword">if</span> (allSections.length == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;

        currentSingleSectionIndex = <span class="hljs-number">0</span>;
        setSelectedSectionForSingleSections(currentSingleSectionIndex);

        $.singleSectionsNavView.height = <span class="hljs-string">"80dp"</span>;
        $.allSectionsNavView.height = <span class="hljs-number">0</span>;
        $.allSectionsNavView.top = <span class="hljs-number">0</span>;
    } <span class="hljs-keyword">else</span> {
        listViewDisplayType = ALL_SECTIONS;
        $.listView.setSections(allSections);

        $.singleSectionsNavView.height = <span class="hljs-number">0</span>;
        $.allSectionsNavView.height = <span class="hljs-string">"80dp"</span>;

    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p><code>getQuestionSection</code> searches of a section that has groupType and returns the SectionObject</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param groupType : (string) groupType to search for
 * 
 * @returns - success :  sectionObject
 * @returns - fail : null
 */</span>
<span class="hljs-keyword">var</span> getQuestionSection = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(groupType)</span> {</span>
    <span class="hljs-keyword">var</span> sectionList = getAllQuestionSections();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> sectionIndex = <span class="hljs-number">0</span>; sectionIndex &lt; sectionList.length; sectionIndex++) {
        <span class="hljs-keyword">if</span> (sectionList[sectionIndex].groupType == groupType) {
            <span class="hljs-keyword">return</span> sectionList[sectionIndex];
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p><code>validateSingleQuestionValue</code> to be called by validateEntireQuestion </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param value : (string) value to be tested 
 * @param questionObject : questionObject to be validated
 * 
 * @returns :  questionObject - updated questionObject
 */</span>
<span class="hljs-keyword">var</span> validateSingleQuestionValue = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value, questionObject)</span> {</span>
    <span class="hljs-keyword">var</span> returnObject = {
        isValid: <span class="hljs-literal">true</span>,
        outPutMessage: <span class="hljs-string">""</span>
    };
    
    <span class="hljs-keyword">var</span> dataType = questionObject.type;

    <span class="hljs-keyword">if</span> (value == <span class="hljs-string">""</span>) {
   	
        <span class="hljs-keyword">if</span> (questionObject.validation.mandatory == <span class="hljs-literal">true</span>) {

            returnObject.isValid = <span class="hljs-literal">false</span>;
            returnObject.outPutMessage = L(<span class="hljs-string">"mandatory_error_text"</span>);
            <span class="hljs-keyword">return</span> returnObject;
        } <span class="hljs-keyword">else</span> {

            <span class="hljs-keyword">var</span> conditionalMandatory = questionObject.validation.conditionalMandatory;
            <span class="hljs-keyword">if</span> (conditionalMandatory.length != <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; conditionalMandatory.length; i++) {

                    <span class="hljs-keyword">var</span> testValue = findQuestionsValue(conditionalMandatory[i].name);

                    <span class="hljs-keyword">if</span> (conditionalMandatory[i].value == <span class="hljs-literal">null</span>) {
                        <span class="hljs-keyword">continue</span>;
                    }

                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> testValueIndex = <span class="hljs-number">0</span>; testValueIndex &lt; testValue.length; testValueIndex++) {
                        <span class="hljs-keyword">if</span> (conditionalMandatory[i].value == testValue[testValueIndex]) {
                            returnObject.isValid = <span class="hljs-literal">false</span>;
                            returnObject.outPutMessage = L(<span class="hljs-string">"mandatory_error_text"</span>);;
                            <span class="hljs-keyword">return</span> returnObject;
                        }
                    }
                }
            }

            returnObject.isValid = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">return</span> returnObject;
        }
    }

    <span class="hljs-keyword">if</span> (dataType == <span class="hljs-string">"numeric"</span> || dataType == <span class="hljs-string">"numericRange"</span>) {
        <span class="hljs-keyword">var</span> test = Alloy.Globals.Validator.isNumber(value, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">if</span> (test == <span class="hljs-literal">false</span>) {
            returnObject.isValid = <span class="hljs-literal">false</span>;
            returnObject.outPutMessage = L(<span class="hljs-string">"numeric_error_text"</span>);
            <span class="hljs-keyword">return</span> returnObject;
        }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dataType == <span class="hljs-string">"decimal"</span> || dataType == <span class="hljs-string">"decimalRange"</span>) {
        <span class="hljs-keyword">var</span> test = Alloy.Globals.Validator.isDecimal(value);
        <span class="hljs-keyword">if</span> (test == <span class="hljs-literal">false</span>) {
            returnObject.isValid = <span class="hljs-literal">false</span>;
            returnObject.outPutMessage = L(<span class="hljs-string">"decimal_error_text"</span>);
            <span class="hljs-keyword">return</span> returnObject;
        }
    }

    <span class="hljs-keyword">if</span> (questionObject.validation.validationTest == <span class="hljs-literal">false</span>) {
        returnObject.isValid = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">return</span> returnObject;
    }

    <span class="hljs-keyword">if</span> (questionObject.validation.min != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">parseInt</span>(value) &lt; <span class="hljs-built_in">parseInt</span>(questionObject.validation.min)) {
            returnObject.isValid = <span class="hljs-literal">false</span>;
            returnObject.outPutMessage = L(<span class="hljs-string">"min_error_text"</span>) +<span class="hljs-string">" "</span>+  questionObject.validation.min;
            <span class="hljs-keyword">return</span> returnObject;
        }
    }

    <span class="hljs-keyword">if</span> (questionObject.validation.max != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">parseInt</span>(value) &gt; <span class="hljs-built_in">parseInt</span>(questionObject.validation.max)) {
            returnObject.isValid = <span class="hljs-literal">false</span>;
            returnObject.outPutMessage = L(<span class="hljs-string">"max_error_text"</span>) +<span class="hljs-string">" "</span>+ questionObject.validation.max;
            <span class="hljs-keyword">return</span> returnObject;
        }
    }

    <span class="hljs-keyword">if</span> (questionObject.validation.minLength != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (value.length &lt;= <span class="hljs-built_in">parseInt</span>(questionObject.validation.minLength)) {
            returnObject.isValid = <span class="hljs-literal">false</span>;
            returnObject.outPutMessage = L(<span class="hljs-string">"minLength_error_text"</span>) +<span class="hljs-string">" "</span>+  questionObject.validation.minLength + <span class="hljs-string">" characters"</span>;
            <span class="hljs-keyword">return</span> returnObject;
        }
    }


    <span class="hljs-keyword">if</span> (questionObject.validation.maxLength != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (value.length &gt;= <span class="hljs-built_in">parseInt</span>(questionObject.validation.maxLength)) {
            returnObject.isValid = <span class="hljs-literal">false</span>;
            returnObject.outPutMessage = L(<span class="hljs-string">"maxLength_error_text"</span>) +<span class="hljs-string">" "</span>+  questionObject.validation.maxLength + <span class="hljs-string">" characters"</span>;
            <span class="hljs-keyword">return</span> returnObject;
        }
    }


    <span class="hljs-keyword">if</span> (questionObject.validation.format != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (Alloy.Globals.Validator.isValidFormat(value) == <span class="hljs-literal">false</span>) {
            returnObject.isValid = <span class="hljs-literal">false</span>;
            returnObject.outPutMessage = L(<span class="hljs-string">"format_error_text"</span>) +<span class="hljs-string">" "</span>+ questionObject.validation.format;
            <span class="hljs-keyword">return</span> returnObject;
        }
    }

    returnObject.isValid = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> returnObject;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p><code>setQuestionError</code> sets the error message for a questionObject</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param isValid : (boolean) if the question is valid
 * @param message : (string) error message to display
 * @param questionObject : questionObject to update
 * 
 * @returns :  questionObject
 */</span>
<span class="hljs-keyword">var</span> setQuestionError = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(isValid, message, questionObject)</span> {</span>
    <span class="hljs-keyword">if</span> (isValid == <span class="hljs-literal">false</span>) {

        questionObject.errorMessageVisable = <span class="hljs-literal">true</span>;
        questionObject.questionErrorMessageView = {
            height: <span class="hljs-string">"30dp"</span>,
            top: <span class="hljs-string">"5dp"</span>
        };
        questionObject.questionErrorMessage = {
            text: message
        };
    } <span class="hljs-keyword">else</span> {
        questionObject.errorMessageVisable = <span class="hljs-literal">false</span>;
        questionObject.questionErrorMessageView = {
            height: <span class="hljs-string">"0dp"</span>,
            top: <span class="hljs-string">"0dp"</span>
        };
        questionObject.questionErrorMessage = {
            text: <span class="hljs-string">""</span>
        };
    }
    <span class="hljs-keyword">return</span> questionObject;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p><code>validateEntireQuestion</code> validate the values of a question</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param questionObject : questionObject to update
 * 
 * @returns :  questionObject
 */</span>
<span class="hljs-keyword">var</span> validateEntireQuestion = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(questionObject)</span> {</span>
	
    <span class="hljs-keyword">var</span> valueList = questionObject.value;
    validateResponse = {
        isValid: <span class="hljs-literal">true</span>,
        outPutMessage: <span class="hljs-string">""</span>
    };
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> valueIndex = <span class="hljs-number">0</span>; valueIndex &lt; valueList.length; valueIndex++) {
        validateResponse = validateSingleQuestionValue(valueList[valueIndex], questionObject);
        <span class="hljs-keyword">if</span> (validateResponse.isValid == <span class="hljs-literal">false</span>) {
            <span class="hljs-keyword">break</span>;
        }
    }

    <span class="hljs-keyword">if</span> (questionObject == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> questionObject;
    } <span class="hljs-keyword">else</span> {

        questionObject = setQuestionError(validateResponse.isValid, validateResponse.outPutMessage, questionObject);
    }
    
    questionObject = setQuestionError(validateResponse.isValid, validateResponse.outPutMessage, questionObject);

    <span class="hljs-keyword">return</span> questionObject;
};

<span class="hljs-comment">/*
</span></pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p><code>Ti.App.addEventListener(&quot;singleViewChange)</code> listen for an event of the question renderer
being changed from single to muiti section view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Ti.App.addEventListener("singleViewChange", function (data) {
    setListViewDisplayTypeToSingleSections(data.isSingleView);
});
*/</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p><code>moveSectionBackClick</code> the callback function for the button click to move the selected section
in the single section mode to the previous section</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param e : not used
 * 
 * @returns :  n/a
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">moveSectionBackClick</span><span class="hljs-params">(e)</span> {</span>
    setSelectedSectionForSingleSections(currentSingleSectionIndex - <span class="hljs-number">1</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p><code>moveSectionNextClick</code> the callback function for the button click to move the selected section
in the single section mode to the next section</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param e : not used
 * 
 * @returns :  n/a
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">moveSectionNextClick</span><span class="hljs-params">(e)</span> {</span>
    setSelectedSectionForSingleSections(currentSingleSectionIndex + <span class="hljs-number">1</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p><code>questionRealTimeValidation</code> called from a textFieldTemplate change event to
this function validates a question value and display updates the question error
message if thr question is not valid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param e.questionObject : questionObject
 * @param e.section : sectionObject
 * @param e.questionIndex : (int) the index of the question in the section
 * 
 * @returns :  n/a
 */</span>
<span class="hljs-keyword">var</span> questionRealTimeValidation = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span>
{</span>
	 e.questionObject = validateEntireQuestion(e.questionObject);
	 <span class="hljs-keyword">if</span> (e.section != <span class="hljs-literal">null</span>) {
        e.section.updateItemAt(e.questionIndex, e.questionObject);
    }
};
exports.questionRealTimeValidation = questionRealTimeValidation;</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p><code>questionValueChange</code> called from a questionTemplate changes its value
the function updates the question error message if needed and removes or addes 
questions if this question value change effets them</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param e.questionObject : questionObject
 * @param e.section : (Titanium.UI.ListSection) sectionObject
 * @param e.questionIndex : (int) the index of the question in the section
 * 
 * @returns :  n/a
 */</span>
<span class="hljs-keyword">var</span> questionValueChange = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Blur the currently focused TF</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">try</span> {
        Alloy.Globals.currentlyFocusedTF &amp;&amp; Alloy.Globals.currentlyFocusedTF.blur();
    } <span class="hljs-keyword">catch</span> (e) {
        Alloy.Globals.Logger.log(<span class="hljs-string">'Cannot blur textfield'</span> + <span class="hljs-built_in">JSON</span>.stringify(e),<span class="hljs-string">"info"</span>);
    }

    <span class="hljs-keyword">if</span> (e.questionObject.alcrmQuestionID === <span class="hljs-string">"I_ASSESSMENT_TITLE"</span> || e.questionObject.alcrmQuestionID === <span class="hljs-string">"LAST_ASSESSMENT_DATE"</span>) {

        <span class="hljs-keyword">var</span> sectionList = getAllQuestionSections();

        <span class="hljs-keyword">var</span> questionTitleRef = findQuestionsRef(sectionList, <span class="hljs-string">"0I_ASSESSMENT_TITLE"</span>, <span class="hljs-string">"0Collector"</span>);
		
		<span class="hljs-keyword">if</span> (e.questionObject.alcrmQuestionID === <span class="hljs-string">"I_ASSESSMENT_TITLE"</span>) {
			questionTitleRef.question = e.questionObject;
		}
		
        <span class="hljs-keyword">if</span> (questionTitleRef !== <span class="hljs-literal">null</span>) {
      
            <span class="hljs-keyword">var</span> questionResponse =
                <span class="hljs-string">"&lt;ques:parameterName&gt;"</span> + questionTitleRef.question.alcrmQuestionID + <span class="hljs-string">"&lt;/ques:parameterName&gt;"</span> +
                <span class="hljs-string">"&lt;ques:parameterValue&gt;"</span> + questionTitleRef.question.displayValue.value + <span class="hljs-string">"&lt;/ques:parameterValue&gt;"</span>;

            questionTitleRef.question.questionResponse = questionResponse;

            questionTitleRef.section.updateItemAt(questionTitleRef.questionIndex, questionTitleRef.question);

            <span class="hljs-keyword">if</span> (e.questionObject.alcrmQuestionID === <span class="hljs-string">"I_ASSESSMENT_TITLE"</span>) {
                e.questionObject = questionTitleRef.question;
            }
        }

    }
    
    <span class="hljs-keyword">if</span>(e.questionObject.alcrmQuestionID === <span class="hljs-string">"I_CENSUS_TYPE"</span> &amp;&amp; e.questionObject.value[<span class="hljs-number">0</span>] != <span class="hljs-string">"20"</span> &amp;&amp; e.questionObject.associatedFileName === $.censusFooterView.getCensusAssociatedFileName()){
    	$.censusFooterView.close();
    }
	
    e.questionObject = validateEntireQuestion(e.questionObject);

    <span class="hljs-keyword">if</span> (e.section != <span class="hljs-literal">null</span>) {
        e.section.updateItemAt(e.questionIndex, e.questionObject);
    }

    Alloy.Globals.localDataHandler.updateQuestion(e.questionObject);
    
    Alloy.Globals.Logger.log(<span class="hljs-string">"questionRender questionValueChange name = "</span>+e.questionObject.name + <span class="hljs-string">", question = "</span>+<span class="hljs-built_in">JSON</span>.stringify(e.questionObject),<span class="hljs-string">"info"</span>);
    newTestDependentQuestions(e.questionObject);

    <span class="hljs-keyword">return</span> e.questionObject;
};
exports.questionValueChange = questionValueChange;</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p><code>toggleScrollLock</code> toggles if the list view is locked in place or not</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @returns :  n/a
 */</span>
<span class="hljs-keyword">var</span> toggleScrollLock = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>
{</span>
	<span class="hljs-keyword">if</span>($.listView.canScroll === <span class="hljs-literal">true</span>){
    	$.listView.setCanScroll(<span class="hljs-literal">false</span>);
    }<span class="hljs-keyword">else</span>{
        $.listView.setCanScroll(<span class="hljs-literal">true</span>);
    }
};
exports.toggleScrollLock = toggleScrollLock;</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p><code>footerTextButtonClick</code> the callback function for the button click text in the qustion renderer footer
opens the userNotesDialog and populates it with the saved Assessment Notes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param e : not used
 * 
 * @returns :  n/a
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">footerTextButtonClick</span><span class="hljs-params">(e)</span> {</span>
    Alloy.createController(<span class="hljs-string">"questionDialogs/userNotesDialog"</span>, {
        notes: currentAssessmentObject.notes,
        title: <span class="hljs-string">"Assessment Notes"</span>,
        closeCallBack: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(notes)</span> {</span>
            currentAssessmentObject.notes = notes;
            Alloy.Globals.localDataHandler.updateSingleAssessmentIndexEntry(currentAssessmentObject);
        }
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p><code>footerNotesButtonClick</code> the callback function for the button click notes in the qustion renderer footer
triggers the slideNotify for the currently selected question to display the server notes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param e : not used
 * 
 * @returns :  n/a
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">footerNotesButtonClick</span><span class="hljs-params">(e)</span> {</span>

    <span class="hljs-keyword">if</span> (questionSelected != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">var</span> questionRef = findQuestionsRef(sectionList, questionSelected.name, questionSelected.groupType);
        <span class="hljs-keyword">if</span> (questionRef != <span class="hljs-literal">null</span>) {
            Alloy.Globals.Util.slideNotify(<span class="hljs-number">30</span>, questionRef.question.alcrmNotes, <span class="hljs-literal">false</span>);
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p><code>footerHelpButtonClick</code> the callback function for the button click help in the qustion renderer footer
triggers the slideNotify for the currently selected question to display the server help message</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param e : not used
 * 
 * @returns :  n/a
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">footerHelpButtonClick</span><span class="hljs-params">(e)</span> {</span>
	
	<span class="hljs-keyword">if</span> (questionSelected != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">var</span> questionRef = findQuestionsRef(sectionList, questionSelected.name, questionSelected.groupType);
        <span class="hljs-keyword">if</span> (questionRef != <span class="hljs-literal">null</span>) {
        	
        	<span class="hljs-keyword">if</span>(questionRef.question.help != <span class="hljs-string">""</span>){
        		alert(questionRef.question.help);
        	}
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p><code>pageDeletedEvent</code> used to delete a census attached to an assessment</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param associatedFileName : (string) fileName to be deleted
 * 
 * @returns :  n/a
 */</span>
<span class="hljs-keyword">var</span> pageDeletedEvent = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(associatedFileName)</span>{</span>
	<span class="hljs-keyword">if</span>(associatedFileName === $.censusFooterView.getCensusAssociatedFileName()){
    	$.censusFooterView.close();
    }
};
exports.pageDeletedEvent = pageDeletedEvent;</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p><code>Ti.App.addEventListener(&quot;startCensesTimer&quot;)</code> fired when a used clicks start for the quick census
this will opem the census timer as a footer of the question renderer and count down based on the 
timerDuration question value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param e.question : questionObject that files the event
 * 
 * @returns :  true or false - depending if the timer opened or not
 */</span>
Ti.App.addEventListener(<span class="hljs-string">"startCensesTimer"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
    <span class="hljs-keyword">var</span> question = e.question;

    <span class="hljs-keyword">var</span> sectionList = getAllQuestionSections();

    <span class="hljs-keyword">var</span> questionRef = findQuestionByAssociatedFileName(<span class="hljs-string">"I_DURATION"</span>, question.associatedFileName);
    <span class="hljs-keyword">if</span> (questionRef != <span class="hljs-literal">null</span>) {

        <span class="hljs-keyword">if</span> (questionRef.question.value[<span class="hljs-number">0</span>] == <span class="hljs-string">""</span>) {

            questionRef.question = setQuestionError(<span class="hljs-literal">false</span>, L(<span class="hljs-string">"duration_error_text"</span>), questionRef.question);
            questionRef.section.updateItemAt(questionRef.questionIndex, questionRef.question);
            Alloy.Globals.localDataHandler.updateQuestion(questionRef.question);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        } <span class="hljs-keyword">else</span> {

            <span class="hljs-keyword">var</span> timerDuration = <span class="hljs-built_in">parseInt</span>(questionRef.question.value[<span class="hljs-number">0</span>]) * <span class="hljs-number">60</span>;
            Alloy.Globals.Logger.log(<span class="hljs-string">"timerDuration = "</span> + timerDuration + <span class="hljs-string">", text = "</span> + questionRef.question.value[<span class="hljs-number">0</span>],<span class="hljs-string">"info"</span>);
            $.censusFooterView.open(timerDuration, question.groupType, question.associatedFileName);
        }
    }
    <span class="hljs-keyword">else</span>{
    	<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-keyword">var</span> questionRef = findQuestionByAssociatedFileName(<span class="hljs-string">"I_CENSUS_QUICK_START"</span>, question.associatedFileName);
    <span class="hljs-keyword">if</span> (questionRef != <span class="hljs-literal">null</span>) {
    	<span class="hljs-keyword">var</span> timeString = Alloy.Globals.moment().format(<span class="hljs-string">"HH:mm"</span>);
    	questionRef.question.displayValue.value = timeString;
    	questionRef.question.value[<span class="hljs-number">0</span>] = timeString;
    	
    	<span class="hljs-keyword">var</span> questionResponse = 
		   <span class="hljs-string">"&lt;ques:parameterName&gt;"</span>+questionRef.question.alcrmQuestionID+<span class="hljs-string">"&lt;/ques:parameterName&gt;"</span>+ 
		   <span class="hljs-string">"&lt;ques:parameterValue&gt;"</span>+timeString+<span class="hljs-string">"&lt;/ques:parameterValue&gt;"</span>+
		   <span class="hljs-string">"&lt;ques:notes&gt;"</span>+questionRef.question.notes+<span class="hljs-string">"&lt;/ques:notes&gt;"</span>;
		questionRef.question.questionResponse = questionResponse;
		
		questionRef.section.updateItemAt(questionRef.questionIndex, questionRef.question);
        Alloy.Globals.localDataHandler.updateQuestion(questionRef.question);
    }
    <span class="hljs-keyword">else</span>{
    	<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
});</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p><code>$.censusFooterView.on(&quot;goToCensus&quot;)</code> fired when a used clicks go to census on the census timer footer
the list view will move to the census usage page and position the top question at the top of the screen</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param e.question : questionObject that files the event
 * 
 * @returns :  true or false - depending if the timer opened or not
 */</span>
$.censusFooterView.on(<span class="hljs-string">"goToCensus"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
    e.censusAssociatedFileName;
    <span class="hljs-keyword">var</span> section = findSectionByAssociatedFileName(<span class="hljs-string">"CensusUsage"</span>, e.censusAssociatedFileName);
    <span class="hljs-keyword">if</span> (section != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (section.getItems().length &gt;= <span class="hljs-number">1</span>) {
            moveToQuestionByName(section.getItems()[<span class="hljs-number">0</span>].name, section.groupType);
        }
    }

});</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p><code>updateAndReturnQuestion</code> fired when a used clicks go to census on the census timer footer
the list view will move to the census usage page and position the top question at the top of the screen</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param question : questionObject to be updated
 * @param value : (string) value to be set
 * @param displayValue : (string) value to populate the textField
 * 
 * @returns :  true or false - depending if the timer opened or not
 */</span>
<span class="hljs-keyword">var</span> updateAndReturnQuestion = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(question, value, displayValue)</span> {</span>
    <span class="hljs-keyword">if</span> (question.template == <span class="hljs-string">"singleSelectTemplate"</span>) {
        question.displayValue = {
            value: displayValue
        };
        question.value = [displayValue];

        <span class="hljs-keyword">var</span> questionResponse =
            <span class="hljs-string">"&lt;ques:parameterName&gt;"</span> + question.alcrmQuestionID + <span class="hljs-string">"&lt;/ques:parameterName&gt;"</span> +
            <span class="hljs-string">"&lt;ques:parameterValue&gt;"</span> + value + <span class="hljs-string">"&lt;/ques:parameterValue&gt;"</span>;

        question.questionResponse = questionResponse;
    }
    <span class="hljs-keyword">return</span> question;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p><code>Ti.App.addEventListener(&quot;setEntireSectionTemplate&quot;)</code> fired when a used clicks go to census on the census timer footer
the list view will move to the census usage page and position the top question at the top of the screen</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param e.groupType : question groupType to match
 * @param e.value : (string) value to be set
 * @param e.questionToChangeTemplate : (string) template name to match
 * 
 * @returns :  n/a
 */</span>
Ti.App.addEventListener(<span class="hljs-string">"setEntireSectionTemplate"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>

    <span class="hljs-keyword">var</span> sectionList = getAllQuestionSections();

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> sectionIndex = <span class="hljs-number">0</span>; sectionIndex &lt; sectionList.length; sectionIndex++) {

        <span class="hljs-keyword">if</span> (sectionList[sectionIndex].groupType != e.groupType) <span class="hljs-keyword">continue</span>;

        <span class="hljs-keyword">var</span> questionList = sectionList[sectionIndex].getItems();
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> questionIndex = <span class="hljs-number">0</span>; questionIndex &lt; sectionList[sectionIndex].getItems().length; questionIndex++) {
        	
            <span class="hljs-keyword">if</span> (questionList[questionIndex].template == e.questionToChangeTemplate) {
                <span class="hljs-keyword">var</span> updatedQuestion = updateAndReturnQuestion(questionList[questionIndex], e.value, e.displayValue);
                sectionList[sectionIndex].updateItemAt(questionIndex, updatedQuestion);
            }
        }
    }

});</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p><code>selectQuestion</code> updates the new question to be selected and removed the ui changes for the last selected question</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param newQuestionSelected : the new questionObject to select
 * 
 * @returns :  QuestionObject
 */</span>
<span class="hljs-keyword">var</span> selectQuestion = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(newQuestionSelected)</span> {</span>
    <span class="hljs-keyword">var</span> sectionList = getAllQuestionSections();


    <span class="hljs-keyword">if</span> (questionSelected != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">var</span> questionRef = findQuestionsRef(sectionList, questionSelected.name, questionSelected.groupType);
        <span class="hljs-keyword">if</span> (questionRef != <span class="hljs-literal">null</span>) {
        	<span class="hljs-keyword">if</span>(questionRef.question.readOnly == <span class="hljs-literal">false</span>){
            
	            questionRef.question.headerView = Alloy.Globals.Styles[<span class="hljs-string">"headerViewDefult"</span>];	    		
	            questionRef.question.selected = <span class="hljs-literal">false</span>;
	            questionRef.section.updateItemAt(questionRef.questionIndex, questionRef.question);

	            Alloy.Globals.localDataHandler.updateQuestion(questionRef.question);
           }
        }
    }
    
    questionSelected = newQuestionSelected;

    Alloy.Globals.Logger.log(<span class="hljs-string">"new questionSelected title = "</span> + questionSelected.title.text,<span class="hljs-string">"info"</span>);

    <span class="hljs-keyword">var</span> questionRef = findQuestionsRef(sectionList, questionSelected.name, questionSelected.groupType);
    <span class="hljs-keyword">if</span> (questionRef != <span class="hljs-literal">null</span>) {
    	<span class="hljs-keyword">if</span>(questionRef.question.readOnly == <span class="hljs-literal">false</span>){
	        questionRef.question.headerView = Alloy.Globals.Styles[<span class="hljs-string">"headerViewSelected"</span>];
	        
	        questionRef.question.selected = <span class="hljs-literal">true</span>;
	        questionRef.section.updateItemAt(questionRef.questionIndex, questionRef.question);
	        newQuestionSelected = questionRef.question;
	        Alloy.Globals.localDataHandler.updateQuestion(questionRef.question);
	       }
    }

    <span class="hljs-keyword">return</span> newQuestionSelected;
};
exports.selectQuestion = selectQuestion;</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p><code>footerPostlayout</code> callback when census timer footer has finshed it height change
resets the list view so there is not overlap</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/***
 * @param e : not used
 * 
 * @returns :  n/a
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">footerPostlayout</span><span class="hljs-params">(e)</span> {</span>
    $.listView.bottom = $.footer.size.height;
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
